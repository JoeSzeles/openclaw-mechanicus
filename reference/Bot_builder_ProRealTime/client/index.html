<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bot Builder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Serif:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/src/style.css">
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors">
  <div id="app" class="flex min-h-screen">
    <!-- Mobile Menu Button (Left) -->
    <button id="menuToggle" class="lg:hidden fixed top-4 left-4 z-50 p-2 rounded-lg bg-white dark:bg-gray-800 shadow-lg">
      <svg class="w-6 h-6 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>

    <!-- Mobile Menu Button (Right) -->
    <button id="promptsToggle" class="lg:hidden fixed top-4 right-4 z-50 p-2 rounded-lg bg-white dark:bg-gray-800 shadow-lg">
      <svg class="w-6 h-6 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
      </svg>
    </button>

    <!-- Left Sidebar - History -->
    <aside id="sidebar" class="fixed lg:static inset-y-0 left-0 z-40 w-72 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 flex flex-col">
      <!-- Translation History (visible on Text tab) -->
      <div id="translationHistorySidebar">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Translation History</h2>
        </div>
        <div id="historyList" class="flex-1 overflow-y-auto p-2 space-y-2 scrollbar-thin max-h-[calc(100vh-80px)]">
          <p class="text-sm text-gray-500 dark:text-gray-400 p-2">No translations yet</p>
        </div>
      </div>
      <!-- Bot History (visible on Bot Builder tab) -->
      <div id="botHistorySidebar" class="hidden">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Bot History</h2>
        </div>
        <div id="botHistoryList" class="flex-1 overflow-y-auto p-2 space-y-2 scrollbar-thin max-h-[calc(100vh-80px)]">
          <p class="text-sm text-gray-500 dark:text-gray-400 p-2">No bots generated yet</p>
        </div>
      </div>
    </aside>

    <!-- Overlay for mobile (left) -->
    <div id="overlay" class="fixed inset-0 bg-black/50 z-30 hidden lg:hidden"></div>

    <!-- Main Content -->
    <main class="flex-1 lg:ml-0">
      <!-- Header -->
      <header class="sticky top-0 z-20 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 p-4">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
          <div class="flex items-center gap-3 ml-12 lg:ml-0">
            <svg class="w-8 h-8 lg:w-10 lg:h-10" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="chartGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#10b981"/>
                  <stop offset="100%" style="stop-color:#059669"/>
                </linearGradient>
                <linearGradient id="botGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#6366f1"/>
                  <stop offset="100%" style="stop-color:#8b5cf6"/>
                </linearGradient>
              </defs>
              <rect x="4" y="8" width="40" height="32" rx="4" fill="url(#botGrad)" opacity="0.9"/>
              <rect x="8" y="12" width="32" height="24" rx="2" fill="#1f2937"/>
              <path d="M12 30L18 24L24 28L32 18L36 22" stroke="url(#chartGrad)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
              <rect x="14" y="20" width="3" height="10" fill="#ef4444" opacity="0.8"/>
              <rect x="20" y="16" width="3" height="14" fill="#10b981" opacity="0.8"/>
              <rect x="26" y="22" width="3" height="8" fill="#ef4444" opacity="0.8"/>
              <rect x="32" y="14" width="3" height="16" fill="#10b981" opacity="0.8"/>
            </svg>
            <h1 class="text-xl lg:text-2xl font-bold bg-gradient-to-r from-emerald-600 to-indigo-600 dark:from-emerald-400 dark:to-indigo-400 bg-clip-text text-transparent">Bot Builder</h1>
          </div>
          <div class="flex items-center gap-2">
            <button id="blankAppBtn" class="px-3 py-2 rounded-lg text-sm font-medium transition-all bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-200 shadow-sm flex items-center gap-1.5" title="Reset to blank app">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
              </svg>
              <span class="hidden sm:inline">New</span>
            </button>
            <button id="donateBtn" class="px-3 py-2 rounded-lg text-sm font-medium transition-all bg-gradient-to-r from-amber-400 to-orange-500 hover:from-amber-500 hover:to-orange-600 text-white shadow-sm hover:shadow flex items-center gap-1.5" title="Buy me a coffee!">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M2 21h18v-2H2M20 8h-2V5h2m0-2H4v10a4 4 0 0 0 4 4h6a4 4 0 0 0 4-4v-3h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/>
              </svg>
              <span class="hidden sm:inline">Donate</span>
            </button>
            <button id="tabBot" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300">Bot Builder</button>
            <button id="tabText" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700">Text</button>
          </div>
          <button id="darkModeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors mr-12 lg:mr-0">
            <svg id="sunIcon" class="w-6 h-6 text-gray-600 dark:text-gray-300 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
            <svg id="moonIcon" class="w-6 h-6 text-gray-600 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
            </svg>
          </button>
        </div>
      </header>

      <!-- Content Area - Text Tab -->
      <div id="textTabContent" class="max-w-4xl mx-auto p-4 lg:p-6 space-y-6">
        <!-- Input Section -->
        <section id="inputSection" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <div class="space-y-4">
            <!-- File Drop Zone -->
            <div id="dropZone" class="drop-zone border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-blue-400 dark:hover:border-blue-500 transition-colors">
              <input type="file" id="fileInput" accept=".txt,.pdf,.md" class="hidden">
              <svg class="w-12 h-12 mx-auto text-gray-400 dark:text-gray-500 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
              </svg>
              <p class="text-gray-600 dark:text-gray-400">Drag & drop .txt, .pdf, or .md files here</p>
              <p class="text-sm text-gray-500 dark:text-gray-500 mt-1">or click to browse</p>
            </div>

            <!-- Text Input -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Source text (optional - leave empty to generate from topic):</label>
              <textarea id="inputText" rows="8" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-y" placeholder="Paste text to translate/transform, or leave empty and describe a topic below to generate new content..."></textarea>
            </div>

            <!-- Metadata -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Book Title (optional)</label>
                <input type="text" id="bookTitle" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter book title">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Author (optional)</label>
                <input type="text" id="authorName" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter author name">
              </div>
            </div>

            <!-- Custom Instructions / Topic -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Topic or Instructions</label>
              <textarea id="customInstructions" rows="3" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-y" placeholder="e.g., 'Write about the history of jazz music' or 'Translate preserving poetic rhythm'..."></textarea>
            </div>

            <!-- Custom Styles -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Output Style & Format</label>
              <textarea id="customStyles" rows="2" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-y" placeholder="e.g., Victorian prose, minimalist poetry, song lyrics with verse/chorus structure..."></textarea>
            </div>

            <!-- Model Selection -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">AI Model</label>
              <select id="modelSelect" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <optgroup label="Anthropic (Claude)">
                  <option value="claude-sonnet-4-5" selected>Claude Sonnet 4.5 (Best)</option>
                  <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
                  <option value="claude-opus-4-20250514">Claude Opus 4</option>
                  <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                  <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku (Fast)</option>
                </optgroup>
                <optgroup label="OpenAI (GPT)">
                  <option value="gpt-4o">GPT-4o</option>
                  <option value="gpt-4o-mini">GPT-4o Mini (Fast)</option>
                  <option value="gpt-4-turbo">GPT-4 Turbo</option>
                </optgroup>
              </select>
            </div>

            <!-- Options Row -->
            <div class="flex flex-wrap items-center gap-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
              <!-- Story Collection Option -->
              <div class="flex items-center gap-2">
                <input type="checkbox" id="storyCollection" class="w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500">
                <label for="storyCollection" class="text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer">Story Collection</label>
              </div>
              
              <!-- Save Prompt Option -->
              <div class="flex items-center gap-2">
                <input type="checkbox" id="savePrompt" checked class="w-5 h-5 rounded border-gray-300 dark:border-gray-600 text-green-600 focus:ring-green-500">
                <label for="savePrompt" class="text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer">Save Prompt</label>
              </div>
            </div>

            <!-- Auto-detect Button -->
            <button id="autoDetectBtn" type="button" class="w-full py-2 px-4 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
              </svg>
              Auto-detect Title & Author from Text
            </button>

            <!-- Generate Button -->
            <button id="translateBtn" class="w-full py-4 px-6 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold rounded-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
              Generate Content
            </button>
          </div>
        </section>

        <!-- Progress Section -->
        <section id="progressSection" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Processing...</span>
              <span id="progressPercent" class="text-sm text-gray-600 dark:text-gray-400">0%</span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden">
              <div id="progressBar" class="bg-blue-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p id="progressStatus" class="text-sm text-gray-600 dark:text-gray-400">Starting...</p>
            <button id="cancelBtn" class="w-full py-2 px-4 bg-red-500 hover:bg-red-600 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
              Cancel Generation
            </button>
          </div>
        </section>

        <!-- Output Section -->
        <section id="outputSection" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Generated Content</h3>
              <button id="copyBtn" class="px-4 py-2 text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
                Copy
              </button>
            </div>
            <div id="translatedText" class="max-h-96 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg font-serif text-gray-800 dark:text-gray-200 whitespace-pre-wrap scrollbar-thin"></div>

            <!-- Chapters/Stories Preview -->
            <div id="chaptersPreview" class="hidden">
              <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Detected <span id="chapterCount">0</span></p>
              <div class="flex gap-4">
                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="radio" name="pdfOption" value="single" checked class="text-blue-600">
                  <span class="text-sm text-gray-700 dark:text-gray-300">One PDF</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="radio" name="pdfOption" value="chapters" class="text-blue-600">
                  <span id="splitOptionLabel" class="text-sm text-gray-700 dark:text-gray-300">One per chapter/story (ZIP)</span>
                </label>
              </div>
            </div>

            <!-- Download Button -->
            <button id="downloadBtn" class="w-full py-3 px-6 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors flex items-center justify-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              Generate & Download PDF
            </button>
          </div>
        </section>
      </div>

      <!-- Content Area - Bot Builder Tab -->
      <div id="botTabContent" class="hidden max-w-6xl mx-auto p-4 lg:p-6 space-y-6">
        <!-- Chart Section -->
        <section class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4">
          <!-- Chart Controls -->
          <div class="flex flex-wrap items-center gap-4 mb-4">
            <div class="flex items-center gap-2">
              <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Asset:</label>
              <select id="assetSelect" class="px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm focus:ring-2 focus:ring-blue-500">
                <optgroup label="Precious Metals">
                  <option value="silver" selected>Silver Futures (SI)</option>
                  <option value="gold">Gold Futures (GC)</option>
                  <option value="xagusd">Silver Spot (XAG/USD)</option>
                  <option value="xauusd">Gold Spot (XAU/USD)</option>
                  <option value="platinum">Platinum (PL)</option>
                  <option value="palladium">Palladium (PA)</option>
                </optgroup>
                <optgroup label="Energy">
                  <option value="oil">Crude Oil WTI (CL)</option>
                  <option value="brent">Brent Crude (BZ)</option>
                  <option value="natgas">Natural Gas (NG)</option>
                  <option value="rbob">Gasoline RBOB (RB)</option>
                </optgroup>
                <optgroup label="Agricultural">
                  <option value="corn">Corn (ZC)</option>
                  <option value="wheat">Wheat (ZW)</option>
                  <option value="soybeans">Soybeans (ZS)</option>
                  <option value="coffee">Coffee (KC)</option>
                  <option value="sugar">Sugar (SB)</option>
                  <option value="cotton">Cotton (CT)</option>
                  <option value="cocoa">Cocoa (CC)</option>
                </optgroup>
                <optgroup label="Forex - Majors">
                  <option value="eurusd">EUR/USD</option>
                  <option value="gbpusd">GBP/USD</option>
                  <option value="usdjpy">USD/JPY</option>
                  <option value="usdchf">USD/CHF</option>
                  <option value="audusd">AUD/USD</option>
                  <option value="usdcad">USD/CAD</option>
                  <option value="nzdusd">NZD/USD</option>
                </optgroup>
                <optgroup label="Forex - Crosses">
                  <option value="eurgbp">EUR/GBP</option>
                  <option value="eurjpy">EUR/JPY</option>
                  <option value="gbpjpy">GBP/JPY</option>
                </optgroup>
                <optgroup label="US Indices">
                  <option value="spx500">S&P 500</option>
                  <option value="nasdaq">NASDAQ Composite</option>
                  <option value="dow">Dow Jones</option>
                  <option value="russell">Russell 2000</option>
                  <option value="vix">VIX Volatility</option>
                </optgroup>
                <optgroup label="European Indices">
                  <option value="dax">DAX 40</option>
                  <option value="ftse">FTSE 100</option>
                  <option value="cac">CAC 40</option>
                  <option value="stoxx">Euro Stoxx 50</option>
                </optgroup>
                <optgroup label="Asian Indices">
                  <option value="nikkei">Nikkei 225</option>
                  <option value="hangseng">Hang Seng</option>
                  <option value="shanghai">Shanghai Composite</option>
                </optgroup>
                <optgroup label="US Stocks">
                  <option value="aapl">Apple (AAPL)</option>
                  <option value="msft">Microsoft (MSFT)</option>
                  <option value="googl">Google (GOOGL)</option>
                  <option value="amzn">Amazon (AMZN)</option>
                  <option value="nvda">NVIDIA (NVDA)</option>
                  <option value="tsla">Tesla (TSLA)</option>
                  <option value="meta">Meta (META)</option>
                </optgroup>
                <optgroup label="Crypto">
                  <option value="btcusd">Bitcoin (BTC/USD)</option>
                  <option value="ethusd">Ethereum (ETH/USD)</option>
                  <option value="solusd">Solana (SOL/USD)</option>
                  <option value="xrpusd">XRP (XRP/USD)</option>
                </optgroup>
                <optgroup label="ETFs">
                  <option value="spy">SPY (S&P 500 ETF)</option>
                  <option value="qqq">QQQ (NASDAQ ETF)</option>
                  <option value="iwm">IWM (Russell 2000 ETF)</option>
                  <option value="gld">GLD (Gold ETF)</option>
                  <option value="slv">SLV (Silver ETF)</option>
                  <option value="uso">USO (Oil ETF)</option>
                  <option value="tlt">TLT (Treasury ETF)</option>
                </optgroup>
              </select>
              <button id="favoriteAsset" class="p-2 text-gray-400 hover:text-yellow-500 transition-colors" title="Add to favorites">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                </svg>
              </button>
            </div>

            <div class="flex items-center gap-2">
              <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Timeframe:</label>
              <select id="timeframeSelect" class="px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm focus:ring-2 focus:ring-blue-500">
                <option value="1s">1 sec</option>
                <option value="2s">2 sec</option>
                <option value="3s">3 sec</option>
                <option value="5s">5 sec</option>
                <option value="10s">10 sec</option>
                <option value="30s">30 sec</option>
                <option value="1m">1 min</option>
                <option value="5m">5 min</option>
                <option value="15m">15 min</option>
                <option value="1h" selected>1 hour</option>
                <option value="4h">4 hour</option>
                <option value="1d">Daily</option>
                <option value="1w">Weekly</option>
                <option value="1M">Monthly</option>
              </select>
            </div>

            <!-- Drawing Tools -->
            <div class="flex items-center gap-1 ml-auto border-l border-gray-200 dark:border-gray-600 pl-4">
              <span class="text-sm text-gray-500 dark:text-gray-400 mr-2">Draw:</span>
              <button id="drawLine" class="draw-tool p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400" title="Trend Line">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 20L20 4"/>
                </svg>
              </button>
              <button id="drawHorizontal" class="draw-tool p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400" title="Horizontal Line">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16"/>
                </svg>
              </button>
              <button id="drawVertical" class="draw-tool p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400" title="Vertical Line">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16"/>
                </svg>
              </button>
              <button id="markHigh" class="draw-tool p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-green-600 dark:text-green-400" title="Mark High">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
                </svg>
              </button>
              <button id="markLow" class="draw-tool p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-red-600 dark:text-red-400" title="Mark Low">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>
              <button id="clearDrawings" class="p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400" title="Clear All">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Chart Container -->
          <div id="chartContainer" class="w-full h-96 bg-gray-900 rounded-lg"></div>
          
          <!-- Drawing Info -->
          <div id="drawingInfo" class="mt-2 text-xs text-gray-500 dark:text-gray-400">
            <span id="drawingCount">0 drawings</span> | Click chart to add points, right-click to finish
          </div>
        </section>

        <!-- Screenshot Upload Section -->
        <section class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Chart Screenshot (optional)</h3>
            <button id="clearScreenshot" class="hidden text-sm text-red-500 hover:text-red-600 transition-colors">Clear</button>
          </div>
          <div id="screenshotDropZone" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center cursor-pointer hover:border-blue-400 dark:hover:border-blue-500 transition-colors">
            <input type="file" id="screenshotInput" accept="image/*" class="hidden">
            <div id="screenshotPlaceholder">
              <svg class="w-10 h-10 mx-auto text-gray-400 dark:text-gray-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
              <p class="text-sm text-gray-600 dark:text-gray-400">Upload a chart screenshot for AI analysis</p>
              <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">Drop image or paste from clipboard (Ctrl+V)</p>
            </div>
            <div id="screenshotPreview" class="hidden">
              <img id="screenshotImage" class="max-h-48 mx-auto rounded-lg shadow-md" alt="Screenshot preview">
            </div>
          </div>
        </section>

        <!-- Bot Settings Section -->
        <section class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <!-- Tab Navigation -->
          <div class="flex items-center gap-2 mb-4 border-b border-gray-200 dark:border-gray-600 pb-3 overflow-x-auto">
            <button id="botForecastTabBtn" class="bot-sub-tab px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-1.5 whitespace-nowrap">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
              </svg>
              Forecast
            </button>
            <button id="botSettingsTabBtn" class="bot-sub-tab px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300">Settings</button>
            <button id="botSimulatorTabBtn" class="bot-sub-tab px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700">Simulator</button>
            <button id="botAiTradingTabBtn" class="bot-sub-tab px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-1.5">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
              </svg>
              AI Trading
            </button>
          </div>

          <!-- Forecast Tab Content -->
          <div id="botForecastTabContent" class="hidden">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white flex items-center gap-2">
                <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
                </svg>
                7-Day Price Forecast
              </h3>
              <div class="flex items-center gap-2">
                <select id="forecastAssetSelect" class="px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200">
                  <option value="silver">Silver</option>
                  <option value="gold">Gold</option>
                  <option value="xauusd">XAU/USD</option>
                  <option value="xagusd">XAG/USD</option>
                  <option value="btc">BTC (Bitcoin)</option>
                  <option value="eth">ETH (Ethereum)</option>
                </select>
                <button id="refreshForecastBtn" class="px-3 py-1.5 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-1">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                  </svg>
                  Refresh
                </button>
              </div>
            </div>
            
            <!-- Market Status Banner -->
            <div class="mb-4 p-2 bg-gray-100 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 text-center">
              <p id="forecastMarketStatus" class="text-sm text-gray-600 dark:text-gray-400">Checking market status...</p>
            </div>
            
            <!-- Forecast Summary -->
            <div id="forecastSummary" class="mb-4 p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
              <div class="flex items-center gap-3">
                <div class="text-2xl">ðŸ”®</div>
                <div>
                  <p class="text-sm font-medium text-gray-700 dark:text-gray-300">Weekly Outlook (Sydney Time)</p>
                  <p id="forecastOutlookText" class="text-lg font-semibold text-gray-800 dark:text-white">Loading forecast...</p>
                </div>
                <div class="ml-auto text-right">
                  <p class="text-xs text-gray-500">Last Accuracy</p>
                  <p id="forecastAccuracyScore" class="text-lg font-bold text-green-600">--%</p>
                </div>
              </div>
            </div>
            
            <!-- 8-Day Forecast Cards (Yesterday + Today + 6 Future) -->
            <div id="forecastCardsContainer" class="grid grid-cols-8 gap-1 mb-4">
              <div class="col-span-8 text-center py-8 text-gray-500 dark:text-gray-400">
                <svg class="w-12 h-12 mx-auto mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
                </svg>
                <p class="text-sm">Click "Refresh" to generate 8-day forecast</p>
              </div>
            </div>
            
            <!-- Selected Day Details -->
            <div id="forecastDayDetails" class="hidden bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
              <div class="flex items-center justify-between mb-4">
                <h4 id="forecastDayTitle" class="text-lg font-semibold text-gray-800 dark:text-white">Day Details</h4>
                <div class="flex items-center gap-2">
                  <button id="updateDayPredictionBtn" class="hidden px-3 py-1.5 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded-lg flex items-center gap-1">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                    Update Prediction
                  </button>
                  <button id="closeDayDetailsBtn" class="p-1 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </button>
                </div>
              </div>
              
              <!-- Current Price Display for Today -->
              <div id="forecastCurrentPriceBar" class="hidden mb-2 p-2 bg-red-100 dark:bg-red-900/30 rounded-lg border border-red-300 dark:border-red-700 flex items-center justify-between">
                <span class="text-xs text-red-700 dark:text-red-300 font-medium">Current Price:</span>
                <span id="forecastCurrentPriceValue" class="text-lg font-bold text-red-600 dark:text-red-400">--</span>
              </div>
              
              <!-- Day Chart (Blue=Predicted, Red=Actual) -->
              <div class="flex items-center justify-end mb-1 gap-3">
                <div class="flex items-center gap-1">
                  <label class="text-xs text-gray-400" title="Higher granularity uses more data points for volatility analysis">Analysis:</label>
                  <select id="forecastTimeframeSelect" class="bg-gray-800 text-white text-xs rounded px-2 py-1 border border-gray-600" title="Data granularity for volatility pattern analysis">
                    <option value="1m">1m (high detail)</option>
                    <option value="5m">5m</option>
                    <option value="15m">15m</option>
                    <option value="1h" selected>1h (default)</option>
                  </select>
                </div>
                <div class="flex items-center gap-1">
                  <label class="text-xs text-gray-400">Height:</label>
                  <input type="range" id="forecastDayChartHeight" min="192" max="512" value="320" class="w-20 h-1 accent-blue-500">
                  <span id="forecastDayChartHeightLabel" class="text-xs text-gray-400 w-8">320</span>
                </div>
              </div>
              <div id="forecastDayChart" class="bg-gray-900 rounded-lg mb-2" style="height: 320px;"></div>
              
              <!-- Price Info (OHLC) -->
              <div id="forecastPriceInfo" class="mb-4"></div>
              
              <!-- Trade Recommendations -->
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                  <p class="text-xs text-green-600 dark:text-green-400 font-medium mb-1">Recommended Entry</p>
                  <p id="forecastEntryPrice" class="text-lg font-bold text-green-700 dark:text-green-300">--</p>
                  <p id="forecastEntryTime" class="text-xs text-green-600">--</p>
                </div>
                <div class="p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800">
                  <p class="text-xs text-red-600 dark:text-red-400 font-medium mb-1">Recommended Exit</p>
                  <p id="forecastExitPrice" class="text-lg font-bold text-red-700 dark:text-red-300">--</p>
                  <p id="forecastExitTime" class="text-xs text-red-600">--</p>
                </div>
              </div>
              
              <!-- AI Suggested Trades (multiple, future only) -->
              <div id="forecastSuggestedTradesSection" class="hidden mb-4">
                <div class="flex items-center justify-between mb-2">
                  <h5 class="text-sm font-semibold text-purple-600 dark:text-purple-400">AI Trade Suggestions (Future Only)</h5>
                  <span id="forecastTradeCount" class="text-xs text-gray-500">0 trades</span>
                </div>
                <div id="forecastSuggestedTradesList" class="space-y-2 max-h-40 overflow-y-auto"></div>
              </div>
              
              <!-- Direction & Confidence -->
              <div class="grid grid-cols-3 gap-3 mb-4">
                <div class="text-center p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-600">
                  <p class="text-xs text-gray-500">Direction</p>
                  <p id="forecastDirection" class="text-lg font-bold">--</p>
                </div>
                <div class="text-center p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-600">
                  <p class="text-xs text-gray-500">Confidence</p>
                  <p id="forecastConfidence" class="text-lg font-bold text-purple-600">--%</p>
                </div>
                <div class="text-center p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-600">
                  <p class="text-xs text-gray-500">Expected Move</p>
                  <p id="forecastExpectedMove" class="text-lg font-bold">--</p>
                </div>
              </div>
              
              <!-- Natural Language Summary -->
              <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                <p class="text-xs text-blue-600 dark:text-blue-400 font-medium mb-1">AI Analysis</p>
                <p id="forecastNaturalSummary" class="text-sm text-gray-700 dark:text-gray-300">--</p>
              </div>
              
              <!-- Backtest Simulation Results -->
              <div id="forecastBacktestResults"></div>
            </div>
            
            <!-- Past Predictions Accuracy -->
            <div class="mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
              <div class="flex items-center justify-between mb-3">
                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">Prediction History</h4>
                <span id="forecastHistoryCount" class="text-xs text-gray-500">0 past predictions</span>
              </div>
              <div id="forecastHistoryList" class="space-y-2 max-h-32 overflow-y-auto">
                <p class="text-xs text-gray-500 italic">No prediction history yet</p>
              </div>
            </div>

            <!-- AI Market Newscast Section -->
            <div class="mt-6 bg-gradient-to-br from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-xl border border-pink-200 dark:border-pink-800 p-4">
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-2">
                  <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-purple-500 flex items-center justify-center shadow-lg">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                    </svg>
                  </div>
                  <div>
                    <h4 class="text-lg font-bold text-gray-800 dark:text-white">Market Radio</h4>
                    <p class="text-xs text-pink-600 dark:text-pink-400">Your 23-Hour Market Companion</p>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <button id="newscastPlayBtn" class="w-12 h-12 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white flex items-center justify-center shadow-lg transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed" title="Play newscast">
                    <svg id="newscastPlayIcon" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                    <svg id="newscastPauseIcon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                    </svg>
                  </button>
                  <button id="newscastGenerateBtn" class="px-3 py-2 text-sm bg-white dark:bg-gray-800 border border-pink-300 dark:border-pink-700 rounded-lg hover:bg-pink-50 dark:hover:bg-pink-900/30 transition-colors flex items-center gap-1" title="Generate new newscast">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    Update
                  </button>
                  <button id="newscastQuickVideoBtn" class="px-3 py-2 text-sm bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed" title="Generate video from current audio">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                    </svg>
                    Video
                  </button>
                </div>
              </div>
              
              <!-- Presenter Selector -->
              <div class="flex items-center gap-3 mb-3 p-2 bg-white/50 dark:bg-gray-800/50 rounded-lg">
                <img id="newscastPresenterImage" src="/images/presenter-caelix.png" alt="Magos Caelix-9" class="w-12 h-12 rounded-full object-cover border-2 border-red-600 shadow-lg shadow-red-500/30">
                <div class="flex-1">
                  <select id="newscastPresenterSelect" class="text-sm font-medium text-gray-800 dark:text-white bg-transparent border-none cursor-pointer focus:ring-0 p-0">
                    <option value="caelix" selected>Magos Caelix-9</option>
                    <option value="sophie">Sophie Mitchell</option>
                    <option value="jack">Jack Thompson</option>
                    <option value="bateman">Patrick Bateman</option>
                    <option value="mcafee">John McAfee</option>
                  </select>
                  <p class="text-xs text-gray-500 dark:text-gray-400">Forge World Markets | Omnissiah's Wisdom</p>
                </div>
                <div class="flex items-center gap-2">
                  <button id="newscastShareBtn" class="p-2 text-gray-500 hover:text-pink-500 transition-colors" title="Share broadcast">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                    </svg>
                  </button>
                  <span id="newscastStatus" class="text-xs text-gray-500">Ready</span>
                  <div id="newscastLoadingIndicator" class="hidden">
                    <svg class="w-4 h-4 animate-spin text-pink-500" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                  </div>
                </div>
              </div>
              
              <!-- Media Customization -->
              <div class="mb-3 p-2 bg-white/50 dark:bg-gray-800/50 rounded-lg text-sm">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-gray-700 dark:text-gray-300 font-medium">Media Customization</span>
                  <button id="toggleMediaCustomization" class="text-xs text-purple-500 hover:text-purple-700">Show</button>
                </div>
                <div id="mediaCustomizationPanel" class="hidden space-y-3">
                  <!-- Script Editor -->
                  <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded border border-blue-200 dark:border-blue-700">
                    <div class="flex items-center justify-between mb-2">
                      <label class="text-xs text-blue-700 dark:text-blue-300 font-medium">Script Editor (edit or paste new text)</label>
                      <button id="copyScriptToEditorBtn" class="text-xs text-blue-500 hover:text-blue-700">Copy from transcript</button>
                    </div>
                    <textarea id="newscastScriptEditor" rows="5" placeholder="Paste or type your script here. Then click 'Generate Audio' to create audio from this text using the selected presenter's voice..." class="w-full px-2 py-1.5 text-sm bg-white dark:bg-gray-800 border border-blue-300 dark:border-blue-600 rounded focus:ring-blue-500 focus:border-blue-500 text-gray-800 dark:text-white placeholder-gray-400 resize-y"></textarea>
                    <div class="flex items-center gap-2 mt-2">
                      <button id="generateAudioFromTextBtn" class="flex-1 px-3 py-1.5 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
                        </svg>
                        Generate Audio from Text
                      </button>
                      <span id="audioFromTextStatus" class="text-xs text-gray-500 hidden"></span>
                    </div>
                  </div>
                  
                  <!-- Avatar -->
                  <div class="p-2 bg-gray-100 dark:bg-gray-700/50 rounded">
                    <div class="flex items-center justify-between mb-1">
                      <label class="text-xs text-gray-600 dark:text-gray-300 font-medium">Avatar Image</label>
                      <label class="text-xs text-purple-500 hover:text-purple-700 cursor-pointer">
                        <input type="file" id="avatarFileInput" accept=".png,.jpg,.jpeg,.gif,.webp" class="hidden">
                        Upload
                      </label>
                    </div>
                    <select id="customAvatarSelect" class="w-full px-2 py-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-gray-800 dark:text-white">
                      <option value="">Default presenter image</option>
                    </select>
                    <div id="avatarUploadStatus" class="text-xs text-gray-500 mt-1 hidden"></div>
                  </div>
                  
                  <!-- Per-Speaker Videos (for podcast mode switching) -->
                  <div class="p-2 bg-purple-100 dark:bg-purple-900/30 rounded border border-purple-200 dark:border-purple-700">
                    <div class="text-xs text-purple-700 dark:text-purple-300 font-medium mb-2">Speaker Videos (switch when talking)</div>
                    <div class="grid grid-cols-5 gap-2">
                      <div>
                        <label class="text-xs text-gray-600 dark:text-gray-400 block mb-1">Caelix-9</label>
                        <select id="speakerVideoCaelix" class="w-full px-1 py-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-gray-800 dark:text-white">
                          <option value="">None</option>
                        </select>
                      </div>
                      <div>
                        <label class="text-xs text-gray-600 dark:text-gray-400 block mb-1">Sophie</label>
                        <select id="speakerVideoSophie" class="w-full px-1 py-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-gray-800 dark:text-white">
                          <option value="">None</option>
                        </select>
                      </div>
                      <div>
                        <label class="text-xs text-gray-600 dark:text-gray-400 block mb-1">Jack</label>
                        <select id="speakerVideoJack" class="w-full px-1 py-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-gray-800 dark:text-white">
                          <option value="">None</option>
                        </select>
                      </div>
                      <div>
                        <label class="text-xs text-gray-600 dark:text-gray-400 block mb-1">Bateman</label>
                        <select id="speakerVideoBateman" class="w-full px-1 py-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-gray-800 dark:text-white">
                          <option value="">None</option>
                        </select>
                      </div>
                      <div>
                        <label class="text-xs text-gray-600 dark:text-gray-400 block mb-1">McAfee</label>
                        <select id="speakerVideoMcafee" class="w-full px-1 py-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-gray-800 dark:text-white">
                          <option value="">None</option>
                        </select>
                      </div>
                    </div>
                    <label class="text-xs text-purple-500 hover:text-purple-700 cursor-pointer mt-2 block">
                      <input type="file" id="videoFileInput" accept=".mp4,.webm,.mov" class="hidden">
                      + Upload new video
                    </label>
                    <div id="videoUploadStatus" class="text-xs text-gray-500 mt-1 hidden"></div>
                  </div>
                  
                  <!-- Background Video (fallback) -->
                  <div class="p-2 bg-gray-100 dark:bg-gray-700/50 rounded">
                    <div class="flex items-center justify-between mb-1">
                      <label class="text-xs text-gray-600 dark:text-gray-300 font-medium">Fallback Background</label>
                    </div>
                    <select id="customBgVideoSelect" class="w-full px-2 py-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-gray-800 dark:text-white">
                      <option value="">No fallback video</option>
                    </select>
                  </div>
                  
                  <!-- Background Music -->
                  <div class="p-2 bg-gray-100 dark:bg-gray-700/50 rounded">
                    <div class="flex items-center justify-between mb-1">
                      <label class="text-xs text-gray-600 dark:text-gray-300 font-medium">Background Music</label>
                      <label class="text-xs text-purple-500 hover:text-purple-700 cursor-pointer">
                        <input type="file" id="musicFileInput" accept=".mp3,.ogg,.wav,.m4a" class="hidden">
                        Upload
                      </label>
                    </div>
                    <select id="customBgMusicSelect" class="w-full px-2 py-1 text-xs bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded text-gray-800 dark:text-white">
                      <option value="">No background music</option>
                    </select>
                    <div class="flex items-center gap-2 mt-2">
                      <span class="text-xs text-gray-500 dark:text-gray-400 w-16">Volume:</span>
                      <input type="range" id="bgMusicVolume" min="0" max="50" value="15" class="flex-1 h-1 bg-gray-300 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer accent-purple-500">
                      <span id="bgMusicVolumeLabel" class="text-xs text-gray-600 dark:text-gray-300 w-8 text-right">15%</span>
                    </div>
                    <div id="musicUploadStatus" class="text-xs text-gray-500 mt-1 hidden"></div>
                  </div>
                </div>
              </div>
              
              <!-- Broadcast Options -->
              <div class="mb-3 p-2 bg-white/50 dark:bg-gray-800/50 rounded-lg text-sm space-y-2">
                <div class="flex items-center gap-4 flex-wrap">
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="newscastMarketForecastCheck" checked class="w-4 h-4 text-pink-500 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 dark:focus:ring-pink-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <span class="text-gray-700 dark:text-gray-300">Market Forecast</span>
                  </label>
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="newscast7DayForecastCheck" class="w-4 h-4 text-pink-500 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 dark:focus:ring-pink-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <span class="text-gray-700 dark:text-gray-300">7-Day Forecast</span>
                  </label>
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="newscastWorldNewsCheck" class="w-4 h-4 text-pink-500 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 dark:focus:ring-pink-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <span class="text-gray-700 dark:text-gray-300">World News</span>
                  </label>
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="newscastIntroAdCheck" checked class="w-4 h-4 text-pink-500 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 dark:focus:ring-pink-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <span class="text-gray-700 dark:text-gray-300">Intro Ad</span>
                  </label>
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="newscastOutroAdCheck" checked class="w-4 h-4 text-pink-500 bg-gray-100 border-gray-300 rounded focus:ring-pink-500 dark:focus:ring-pink-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <span class="text-gray-700 dark:text-gray-300">Outro Ad</span>
                  </label>
                </div>
                <div class="flex items-center gap-4 flex-wrap pt-2 border-t border-gray-200 dark:border-gray-700">
                  <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="newscastDailyPodcastCheck" class="w-4 h-4 text-purple-500 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <span class="text-gray-700 dark:text-gray-300 font-medium">Daily Podcast</span>
                    <span class="text-xs text-purple-500">(2+ hosts discuss)</span>
                  </label>
                  <label id="guestParticipationLabel" class="flex items-center gap-2 cursor-pointer opacity-50">
                    <input type="checkbox" id="newscastGuestCheck" disabled class="w-4 h-4 text-purple-500 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <span class="text-gray-700 dark:text-gray-300">Guest Participation</span>
                  </label>
                </div>
                <div id="podcastTopicContainer" class="hidden">
                  <label class="block text-xs text-purple-600 dark:text-purple-400 mb-1 font-medium">Podcast Discussion Topic (optional - leave empty for market talk)</label>
                  <textarea id="podcastTopicInput" rows="2" placeholder="e.g., Magos Caelix-9 has a heated debate with Sophie about capitalism vs the Machine God. Sophie blames the patriarchy while Caelix defends the sacred order of the Omnissiah..." class="w-full px-3 py-1.5 text-sm bg-white dark:bg-gray-700 border border-purple-300 dark:border-purple-600 rounded-lg focus:ring-purple-500 focus:border-purple-500 text-gray-800 dark:text-white placeholder-gray-400"></textarea>
                </div>
                <div class="flex items-center gap-3">
                  <label class="text-xs text-gray-600 dark:text-gray-400 whitespace-nowrap">Script Length:</label>
                  <input type="range" id="scriptLengthSlider" min="100" max="500" value="200" step="50" class="flex-1 h-1 bg-gray-300 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer accent-pink-500">
                  <span id="scriptLengthLabel" class="text-xs text-gray-600 dark:text-gray-300 w-20 text-right">150-250 words</span>
                </div>
                <div>
                  <input type="text" id="newscastAdTopic" placeholder="Ad topic (e.g., Bot Builder, AI Trading, your product...)" value="Bot Builder - AI-powered trading bot generator with American Psycho humor" class="w-full px-3 py-1.5 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-pink-500 focus:border-pink-500 text-gray-800 dark:text-white placeholder-gray-400">
                </div>
              </div>
              
              <!-- Share Panel (hidden by default) -->
              <div id="newscastSharePanel" class="hidden mb-3 p-3 bg-white dark:bg-gray-800 rounded-lg border border-pink-200 dark:border-pink-700">
                <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">Share this broadcast:</p>
                <div class="flex items-center gap-2">
                  <button id="shareTwitterBtn" class="p-2 bg-blue-400 hover:bg-blue-500 text-white rounded-lg transition-colors" title="Share on X/Twitter">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                  </button>
                  <button id="shareFacebookBtn" class="p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors" title="Share on Facebook">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                  </button>
                  <button id="shareLinkedInBtn" class="p-2 bg-blue-700 hover:bg-blue-800 text-white rounded-lg transition-colors" title="Share on LinkedIn">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                  </button>
                  <button id="shareCopyBtn" class="p-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors flex items-center gap-1" title="Copy to clipboard">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                    <span class="text-xs">Copy</span>
                  </button>
                </div>
              </div>
              
              <!-- Newscast Transcript -->
              <div id="newscastTranscript" class="bg-white dark:bg-gray-800 rounded-lg p-3 max-h-48 overflow-y-auto border border-pink-100 dark:border-gray-700">
                <p class="text-sm text-gray-600 dark:text-gray-400 italic">Click "Update" to generate today's market briefing from Sophie...</p>
              </div>
              
              <!-- Audio Controls -->
              <div id="newscastAudioProgress" class="hidden mt-3 space-y-2">
                <!-- Progress Bar (clickable) -->
                <div class="flex items-center gap-2">
                  <span id="newscastCurrentTime" class="text-xs text-gray-500 w-10">0:00</span>
                  <div id="newscastProgressTrack" class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden cursor-pointer relative">
                    <div id="newscastProgressBar" class="h-full bg-gradient-to-r from-pink-500 to-purple-500 rounded-full transition-all" style="width: 0%"></div>
                  </div>
                  <span id="newscastDuration" class="text-xs text-gray-500 w-10">0:00</span>
                </div>
                <!-- Playback Controls -->
                <div class="flex items-center justify-center gap-3">
                  <button id="newscastSkipBack" class="p-2 text-gray-500 hover:text-pink-500 transition-colors" title="Skip back 10s">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0019 16V8a1 1 0 00-1.6-.8l-5.333 4zM4.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0011 16V8a1 1 0 00-1.6-.8l-5.334 4z"/>
                    </svg>
                  </button>
                  <button id="newscastSkipForward" class="p-2 text-gray-500 hover:text-pink-500 transition-colors" title="Skip forward 10s">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.933 12.8a1 1 0 000-1.6L6.6 7.2A1 1 0 005 8v8a1 1 0 001.6.8l5.333-4zM19.933 12.8a1 1 0 000-1.6l-5.333-4A1 1 0 0013 8v8a1 1 0 001.6.8l5.333-4z"/>
                    </svg>
                  </button>
                  <button id="newscastDownload" class="p-2 text-gray-500 hover:text-pink-500 transition-colors" title="Download MP3">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                  </button>
                  <button id="newscastGenerateVideo" class="p-2 text-gray-500 hover:text-purple-500 transition-colors" title="Generate Video">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/>
                    </svg>
                  </button>
                </div>
              </div>
              
              <!-- Video Generation Status -->
              <div id="newscastVideoStatus" class="hidden mt-2 p-2 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4 animate-spin text-purple-500" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  <span id="newscastVideoStatusText" class="text-sm text-purple-600 dark:text-purple-400">Generating video...</span>
                </div>
              </div>
              
              <!-- Broadcast History Section -->
              <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Broadcast History
                  </h4>
                  <span id="newscastHistoryCount" class="text-xs text-gray-500 dark:text-gray-400">0 broadcasts</span>
                </div>
                <div id="newscastHistoryList" class="space-y-2 max-h-64 overflow-y-auto">
                  <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">No broadcasts yet. Generate your first newscast above!</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Settings Tab Content -->
          <div id="botSettingsTabContent">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Bot Strategy Settings</h3>
            </div>
            
            <!-- Bot Name -->
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Bot Name</label>
              <input type="text" id="botName" placeholder="Enter a name for your bot..." class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <!-- Capital & Fees Settings -->
              <div class="space-y-4">
                <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wide">Capital & Fees</h4>
                
                <div>
                  <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Initial Capital ($)</label>
                  <input type="number" id="initialCapital" value="2000" step="100" min="100" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                </div>
                
                <div>
                  <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Max Position Size</label>
                  <input type="number" id="maxPositionSize" value="1" step="0.1" min="0.1" max="100" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                </div>
                
                <div class="flex items-center gap-2">
                  <input type="checkbox" id="useOrderFee" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                  <label for="useOrderFee" class="text-sm text-gray-700 dark:text-gray-300">Order Fee</label>
                  <input type="number" id="orderFee" value="7" step="0.5" min="0" class="w-16 px-2 py-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                  <span class="text-xs text-gray-500">$/order</span>
                </div>
                
                <div class="flex items-center gap-2">
                  <input type="checkbox" id="useSpread" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                  <label for="useSpread" class="text-sm text-gray-700 dark:text-gray-300">Spread</label>
                  <input type="number" id="spreadPips" value="2" step="0.1" min="0" class="w-16 px-2 py-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                  <span class="text-xs text-gray-500">pips</span>
                </div>
              </div>

              <!-- Position Settings -->
              <div class="space-y-4">
                <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wide">Position</h4>
                
                <div>
                  <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Position Size</label>
                  <input type="number" id="positionSize" value="0.5" step="0.1" min="0.1" max="10" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                </div>
                
                <div>
                  <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Trade Type</label>
                  <select id="tradeType" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                    <option value="both">Long & Short</option>
                    <option value="long">Long Only</option>
                    <option value="short">Short Only</option>
                  </select>
                </div>
                
                <div class="flex items-center gap-2">
                  <input type="checkbox" id="cumulateOrders" class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                  <label for="cumulateOrders" class="text-sm text-gray-700 dark:text-gray-300">Cumulate Orders</label>
                </div>
              </div>

            <!-- Stop/Target Settings -->
            <div class="space-y-4">
              <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wide">Risk Management</h4>
              
              <div>
                <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Stop Loss (points)</label>
                <input type="number" id="stopLoss" value="7000" step="100" min="0" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
              </div>
              
              <div>
                <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Take Profit (points)</label>
                <input type="number" id="takeProfit" value="300" step="10" min="0" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
              </div>
              
              <div class="flex items-center gap-2">
                <input type="checkbox" id="useTrailingStop" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                <label for="useTrailingStop" class="text-sm text-gray-700 dark:text-gray-300">Use Trailing Stop</label>
              </div>
            </div>

            <!-- Trailing Stop Settings -->
            <div class="space-y-4">
              <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wide">Trailing Stop</h4>
              
              <div>
                <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Trailing % <span id="trailingPercentVal" class="text-blue-600">0.46</span></label>
                <input type="range" id="trailingPercent" value="0.46" step="0.01" min="0.1" max="2" class="w-full">
              </div>
              
              <div>
                <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Step % <span id="stepPercentVal" class="text-blue-600">0.018</span></label>
                <input type="range" id="stepPercent" value="0.018" step="0.001" min="0.001" max="0.1" class="w-full">
              </div>
            </div>

            <!-- Indicator Settings -->
            <div class="space-y-4">
              <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wide">Indicators</h4>
              
              <div class="flex items-center gap-2">
                <input type="checkbox" id="useOBV" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                <label for="useOBV" class="text-sm text-gray-700 dark:text-gray-300">Use OBV</label>
              </div>
              
              <div>
                <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">OBV Period</label>
                <input type="number" id="obvPeriod" value="5" step="1" min="1" max="50" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
              </div>
              
              <div class="flex items-center gap-2">
                <input type="checkbox" id="useHeikinAshi" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                <label for="useHeikinAshi" class="text-sm text-gray-700 dark:text-gray-300">Use Heikin Ashi</label>
              </div>
            </div>

            <!-- Strategy Selection -->
            <div class="space-y-4">
              <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wide">Strategy</h4>
              
              <div>
                <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Base Strategy</label>
                <div class="flex gap-2">
                  <select id="strategyType" class="flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                    <option value="13thwarrior">13th Warrior (OBV + HA)</option>
                    <option value="sniper">Sniper (Immediate Entry)</option>
                    <option value="breakout">Breakout</option>
                    <option value="custom">Custom (from chart)</option>
                    <option value="paste">Custom / Paste Code</option>
                  </select>
                  <button id="getStrategyIdeasBtn" type="button" class="px-3 py-2 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-1.5 whitespace-nowrap" title="Find strategies from ProRealCode forum">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                    Ideas
                  </button>
                  <button id="prtDocsBtn" type="button" class="px-3 py-2 bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-1.5 whitespace-nowrap" title="Manage ProRealTime syntax documentation">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                    </svg>
                    Docs
                  </button>
                </div>
              </div>
              
              <!-- Strategy Code Preview -->
              <div id="strategyCodePreview" class="hidden" style="width: 300%;">
                <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Strategy Code Preview</label>
                <pre id="strategyCodePreviewContent" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-900 text-gray-100 text-xs font-mono overflow-x-auto overflow-y-auto" style="max-height: 200px;"></pre>
              </div>
              
              <!-- Base Code Input (shown when "Paste Base Code" selected) -->
              <div id="baseCodeInputContainer" class="hidden" style="width: 300%;">
                <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Paste Base Code / Custom Description</label>
                <textarea id="baseCodeInput" rows="6" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm font-mono resize-y" placeholder="Paste existing ProRealTime code OR describe your strategy idea for AI to research and build from scratch..."></textarea>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Paste code to modify, or describe a strategy idea. AI may ask clarifying questions before generating.</p>
                
                <!-- AI Research Q&A Section -->
                <div id="aiResearchQA" class="hidden mt-4 p-4 rounded-lg bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 border border-purple-200 dark:border-purple-700">
                  <div class="flex items-center gap-2 mb-3">
                    <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span class="font-medium text-purple-800 dark:text-purple-300">AI Research Questions</span>
                  </div>
                  <div id="aiQuestionsContent" class="text-sm text-gray-700 dark:text-gray-300 mb-3 whitespace-pre-wrap"></div>
                  <textarea id="userAnswersInput" rows="3" class="w-full px-3 py-2 rounded-lg border border-purple-300 dark:border-purple-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm resize-y" placeholder="Type your answers here..."></textarea>
                  <div class="flex gap-2 mt-2">
                    <button id="submitAnswersBtn" type="button" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium rounded-lg transition-colors">
                      Submit Answers & Generate
                    </button>
                    <button id="skipQuestionsBtn" type="button" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white text-sm font-medium rounded-lg transition-colors">
                      Skip & Generate Anyway
                    </button>
                  </div>
                </div>
              </div>
            </div>
            </div>

            <!-- Time & Session Filters -->
            <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-600">
              <div class="flex items-center justify-between mb-4">
                <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wide">Time & Session Filters</h4>
                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="checkbox" id="enableTimeFilters" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                  <span class="text-sm text-gray-700 dark:text-gray-300">Enable Filters</span>
                </label>
              </div>
              
              <div id="timeFiltersContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Timezone & Schedule -->
                <div class="space-y-3">
                  <div>
                    <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Timezone</label>
                    <select id="timezone" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                      <option value="Australia/Brisbane" selected>Brisbane (UTC+10)</option>
                      <option value="Australia/Sydney">Sydney (AEST/AEDT)</option>
                      <option value="America/New_York">New York (EST/EDT)</option>
                      <option value="America/Chicago">Chicago (CST/CDT)</option>
                      <option value="Europe/London">London (GMT/BST)</option>
                      <option value="Europe/Paris">Paris (CET/CEST)</option>
                      <option value="Asia/Tokyo">Tokyo (JST)</option>
                      <option value="Asia/Singapore">Singapore (SGT)</option>
                      <option value="UTC">UTC</option>
                    </select>
                  </div>
                  <div class="flex items-center gap-2">
                    <input type="checkbox" id="excludeWeekends" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                    <label for="excludeWeekends" class="text-sm text-gray-700 dark:text-gray-300">Exclude Weekends</label>
                  </div>
                  <div class="flex items-center gap-2">
                    <input type="checkbox" id="excludeHolidays" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                    <label for="excludeHolidays" class="text-sm text-gray-700 dark:text-gray-300">Exclude Holidays</label>
                  </div>
                </div>

                <!-- Trading Hours -->
                <div class="space-y-3">
                  <div class="flex items-center gap-2">
                    <input type="checkbox" id="useTimeFilter" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                    <label for="useTimeFilter" class="text-sm text-gray-700 dark:text-gray-300">Time Filter</label>
                  </div>
                  <div class="flex items-center gap-2">
                    <label class="text-sm text-gray-700 dark:text-gray-300 w-12">Start</label>
                    <input type="time" id="tradingStartTime" value="09:00" class="flex-1 px-2 py-1.5 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                  </div>
                  <div class="flex items-center gap-2">
                    <label class="text-sm text-gray-700 dark:text-gray-300 w-12">End</label>
                    <input type="time" id="tradingEndTime" value="17:00" class="flex-1 px-2 py-1.5 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                  </div>
                </div>

                <!-- Session Avoidance -->
                <div class="space-y-3">
                  <div class="flex items-center gap-2">
                    <input type="checkbox" id="excludeOpenPeriod" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                    <label for="excludeOpenPeriod" class="text-sm text-gray-700 dark:text-gray-300">Skip First</label>
                    <input type="number" id="openPeriodMinutes" value="30" step="5" min="5" max="120" class="w-14 px-2 py-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                    <span class="text-xs text-gray-500">min</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <input type="checkbox" id="excludeClosePeriod" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                    <label for="excludeClosePeriod" class="text-sm text-gray-700 dark:text-gray-300">Skip Last</label>
                    <input type="number" id="closePeriodMinutes" value="30" step="5" min="5" max="120" class="w-14 px-2 py-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                    <span class="text-xs text-gray-500">min</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <input type="checkbox" id="closeBeforeEnd" class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">
                    <label for="closeBeforeEnd" class="text-sm text-gray-700 dark:text-gray-300">Close</label>
                    <input type="number" id="closeBeforeMinutes" value="15" step="5" min="5" max="60" class="w-14 px-2 py-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                    <span class="text-xs text-gray-500">min before</span>
                  </div>
                </div>

                <!-- Trading Days -->
                <div class="space-y-3">
                  <span class="text-sm text-gray-700 dark:text-gray-300">Trading Days</span>
                  <div class="flex flex-wrap gap-x-4 gap-y-2">
                    <label class="flex items-center gap-1 text-sm text-gray-700 dark:text-gray-300">
                      <input type="checkbox" id="tradeMon" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">M
                    </label>
                    <label class="flex items-center gap-1 text-sm text-gray-700 dark:text-gray-300">
                      <input type="checkbox" id="tradeTue" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">T
                    </label>
                    <label class="flex items-center gap-1 text-sm text-gray-700 dark:text-gray-300">
                      <input type="checkbox" id="tradeWed" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">W
                    </label>
                    <label class="flex items-center gap-1 text-sm text-gray-700 dark:text-gray-300">
                      <input type="checkbox" id="tradeThu" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">T
                    </label>
                    <label class="flex items-center gap-1 text-sm text-gray-700 dark:text-gray-300">
                      <input type="checkbox" id="tradeFri" checked class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">F
                    </label>
                    <label class="flex items-center gap-1 text-sm text-gray-700 dark:text-gray-300">
                      <input type="checkbox" id="tradeSat" class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">S
                    </label>
                    <label class="flex items-center gap-1 text-sm text-gray-700 dark:text-gray-300">
                      <input type="checkbox" id="tradeSun" class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600">S
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Additional Instructions -->
            <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-600">
              <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-3">Additional Instructions</h4>
              <textarea id="botExtraInstructions" rows="2" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm resize-y" placeholder="Any special conditions or modifications..."></textarea>
            </div>

            <!-- Generate Bot Buttons -->
            <div class="mt-6 space-y-3">
              <button id="previewSummaryBtn" class="w-full py-2 px-4 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-lg transition-all flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
                Preview Summary
              </button>
              <button id="generateBotBtn" class="w-full py-4 px-6 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold rounded-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                </svg>
                Generate ProRealTime Bot Code
              </button>
              <!-- Progress Bar -->
              <div id="generateProgress" class="hidden">
                <div class="flex items-center justify-between text-xs text-gray-600 dark:text-gray-400 mb-1">
                  <span id="generateProgressText">Generating bot code...</span>
                  <span id="generateProgressPercent">0%</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden">
                  <div id="generateProgressBar" class="bg-gradient-to-r from-green-500 to-emerald-500 h-full rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Simulator Tab Content -->
          <div id="botSimulatorTabContent" class="hidden">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Backtest Simulator</h3>
              <div class="flex items-center gap-2">
                <div class="flex items-center gap-1">
                  <label class="text-xs text-gray-600 dark:text-gray-400">Datapoints:</label>
                  <select id="simDatapoints" class="px-2 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500">
                    <option value="1000">1k</option>
                    <option value="2000" selected>2k</option>
                    <option value="5000">5k</option>
                    <option value="10000">10k</option>
                    <option value="100000">100k</option>
                  </select>
                </div>
                <button id="downloadResultsBtn" class="hidden px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg transition-colors flex items-center gap-2 text-sm">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                  </svg>
                  Download JSON
                </button>
                <button id="runModifiedBtn" class="hidden px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors flex items-center gap-2 disabled:opacity-50 text-sm">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                  </svg>
                  Run Modified
                </button>
                <button id="runSimulatorBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors flex items-center gap-2 disabled:opacity-50">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  Run Backtest
                </button>
              </div>
            </div>

            <!-- Variable Optimization Panel -->
            <div id="variableOptPanel" class="hidden mb-6 bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-xl border border-indigo-200 dark:border-indigo-700 p-4">
              <div class="flex items-center justify-between mb-4">
                <h4 class="text-sm font-semibold text-indigo-700 dark:text-indigo-300 flex items-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                  </svg>
                  Variable Optimization
                </h4>
                <div class="flex items-center gap-2">
                  <button id="runModifiedBtn2" class="hidden px-3 py-1.5 text-xs bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-1.5">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                    </svg>
                    Run Modified
                  </button>
                  <button id="detectVariablesBtn" class="px-3 py-1.5 text-xs bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors">
                    Detect Variables
                  </button>
                </div>
              </div>
              
              <!-- Detected Variables with Sliders -->
              <div id="variableSlidersContainer" class="space-y-3 mb-4">
                <p class="text-sm text-gray-500 dark:text-gray-400 italic">Generate a bot first, then click "Detect Variables" to adjust parameters.</p>
              </div>
              
              <!-- Auto-Optimize Section -->
              <div class="mt-4 pt-4 border-t border-indigo-200 dark:border-indigo-600">
                <div class="flex flex-wrap items-center gap-3">
                  <div class="flex items-center gap-2">
                    <label class="text-sm text-gray-700 dark:text-gray-300">Iterations:</label>
                    <input type="number" id="optimizeIterations" value="20" min="5" max="100" step="5" class="w-16 px-2 py-1 text-sm rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                  </div>
                  <div class="flex items-center gap-2">
                    <label class="text-sm text-gray-700 dark:text-gray-300">Optimize for:</label>
                    <select id="optimizeMetric" class="px-2 py-1 text-sm rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                      <option value="totalGain">Total Gain</option>
                      <option value="winRate">Win Rate</option>
                      <option value="gainLossRatio">Gain/Loss Ratio</option>
                      <option value="sharpe">Sharpe-like</option>
                    </select>
                  </div>
                  <button id="varOptimizeBtn" class="px-4 py-1.5 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2 disabled:opacity-50">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    Variable Optimize
                  </button>
                </div>
                
                <!-- Optimization Progress -->
                <div id="optimizeProgress" class="hidden mt-3">
                  <div class="flex items-center justify-between text-xs text-gray-600 dark:text-gray-400 mb-1">
                    <span id="optimizeProgressText">Running iteration 0 of 20...</span>
                    <span id="optimizeProgressPercent">0%</span>
                  </div>
                  <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                    <div id="optimizeProgressBar" class="bg-gradient-to-r from-purple-500 to-indigo-500 h-2 rounded-full transition-all" style="width: 0%"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Best Results Panel -->
            <div id="bestResultsPanel" class="hidden mb-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl border border-green-200 dark:border-green-700 p-4">
              <div class="flex items-center justify-between mb-4">
                <h4 class="text-lg font-semibold text-green-700 dark:text-green-300 flex items-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                  </svg>
                  Optimization Results
                  <span id="resultsCount" class="text-sm font-normal text-gray-500 dark:text-gray-400"></span>
                </h4>
                <button id="toggleResultsExpand" class="text-sm text-green-600 dark:text-green-400 hover:underline flex items-center gap-1">
                  <span id="expandBtnText">Expand</span>
                  <svg id="expandBtnIcon" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                  </svg>
                </button>
              </div>
              
              <!-- Comparison Chart -->
              <div id="resultsComparisonChart" class="mb-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 p-3">
                <div class="flex gap-1 items-end justify-center h-32" id="comparisonBars"></div>
                <div class="flex justify-center gap-4 mt-2 text-xs text-gray-500 dark:text-gray-400">
                  <span class="flex items-center gap-1"><span class="w-3 h-3 bg-green-500 rounded"></span> Gain</span>
                  <span class="flex items-center gap-1"><span class="w-3 h-3 bg-blue-500 rounded"></span> Win Rate</span>
                </div>
              </div>
              
              <!-- Results List -->
              <div id="bestResultsList" class="space-y-3 overflow-y-auto transition-all duration-300" style="max-height: 350px;" data-expanded="false">
              </div>
            </div>
            
            <!-- Detail Modal -->
            <div id="resultDetailModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center p-4">
              <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                  <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                    <span id="modalRankBadge" class="w-8 h-8 flex items-center justify-center rounded-full bg-green-500 text-white font-bold">#1</span>
                    Result Details
                  </h3>
                  <button id="closeDetailModal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
                  <!-- Performance Summary -->
                  <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 rounded-xl p-4 text-center">
                      <div id="modalTotalGain" class="text-2xl font-bold text-green-600 dark:text-green-400">+$0.00</div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">Total Gain</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-xl p-4 text-center">
                      <div id="modalWinRate" class="text-2xl font-bold text-blue-600 dark:text-blue-400">0%</div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">Win Rate</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-violet-50 dark:from-purple-900/30 dark:to-violet-900/30 rounded-xl p-4 text-center">
                      <div id="modalTrades" class="text-2xl font-bold text-purple-600 dark:text-purple-400">0</div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">Total Trades</div>
                    </div>
                  </div>
                  
                  <!-- Variables Used -->
                  <div class="mb-6">
                    <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Variables</h4>
                    <div id="modalVariables" class="flex flex-wrap gap-2"></div>
                  </div>
                  
                  <!-- Additional Stats -->
                  <div class="mb-6 grid grid-cols-2 gap-4 text-sm">
                    <div class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700">
                      <span class="text-gray-500">Max Drawdown</span>
                      <span id="modalDrawdown" class="font-medium text-red-600 dark:text-red-400">-$0.00</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700">
                      <span class="text-gray-500">Max Runup</span>
                      <span id="modalRunup" class="font-medium text-green-600 dark:text-green-400">+$0.00</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700">
                      <span class="text-gray-500">Gain/Loss Ratio</span>
                      <span id="modalGainLoss" class="font-medium text-gray-900 dark:text-white">0.00</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700">
                      <span class="text-gray-500">Best Trade</span>
                      <span id="modalBestTrade" class="font-medium text-green-600 dark:text-green-400">+$0.00</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700">
                      <span class="text-gray-500">Worst Trade</span>
                      <span id="modalWorstTrade" class="font-medium text-red-600 dark:text-red-400">-$0.00</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100 dark:border-gray-700">
                      <span class="text-gray-500">Avg Gain/Trade</span>
                      <span id="modalAvgGain" class="font-medium text-gray-900 dark:text-white">$0.00</span>
                    </div>
                  </div>
                  
                  <!-- Code with Variables Applied -->
                  <div>
                    <div class="flex items-center justify-between mb-2">
                      <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300">Code with Variables Applied</h4>
                      <button id="modalCopyCode" class="px-3 py-1 text-xs bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors flex items-center gap-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                        </svg>
                        Copy Code
                      </button>
                    </div>
                    <pre id="modalCode" class="bg-gray-900 text-gray-100 p-4 rounded-lg text-xs font-mono overflow-x-auto max-h-60 overflow-y-auto"></pre>
                  </div>
                </div>
                <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3">
                  <button id="modalApplyBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium">
                    Apply This Configuration
                  </button>
                </div>
              </div>
            </div>

            <!-- Simulator Status -->
            <div id="simulatorStatus" class="hidden mb-4 p-3 rounded-lg bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-sm">
              Running simulation...
            </div>

            <!-- No Results Placeholder -->
            <div id="simulatorNoResults" class="text-center py-12 text-gray-500 dark:text-gray-400">
              <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              <p class="text-lg font-medium mb-2">No simulation results yet</p>
              <p class="text-sm">Generate a bot first, then click "Run Backtest" to see results</p>
            </div>

            <!-- Results Dashboard -->
            <div id="simulatorResults" class="hidden space-y-6">
              <!-- Equity Curve Chart -->
              <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400">Equity Curve</h4>
                  <div class="flex items-center gap-4 text-xs">
                    <div class="flex items-center gap-1">
                      <div class="w-3 h-0.5 bg-cyan-400"></div>
                      <span class="text-gray-500 dark:text-gray-400">Equity</span>
                    </div>
                    <div class="flex items-center gap-1 ml-4">
                      <label class="text-gray-500 dark:text-gray-400">Height:</label>
                      <input type="range" id="equityChartHeight" min="128" max="512" value="256" class="w-20 h-1 accent-cyan-500">
                      <span id="equityChartHeightLabel" class="text-gray-500 dark:text-gray-400 w-8">256</span>
                    </div>
                  </div>
                </div>
                <div id="equityCurveChart" class="w-full" style="height: 256px;"></div>
              </div>

              <!-- Price Chart with Trade Markers -->
              <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400">Trade Analysis</h4>
                  <div class="flex items-center gap-4 text-xs">
                    <div class="flex items-center gap-1">
                      <svg class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 4l-8 8h6v8h4v-8h6z"/></svg>
                      <span class="text-gray-500 dark:text-gray-400">Buy</span>
                    </div>
                    <div class="flex items-center gap-1">
                      <svg class="w-3 h-3 text-red-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 20l8-8h-6V4h-4v8H4z"/></svg>
                      <span class="text-gray-500 dark:text-gray-400">Sell</span>
                    </div>
                    <div class="flex items-center gap-1">
                      <div class="w-2 h-2 rounded-full bg-yellow-400"></div>
                      <span class="text-gray-500 dark:text-gray-400">Exit</span>
                    </div>
                  </div>
                </div>
                <div id="tradeAnalysisChart" class="h-64 w-full"></div>
              </div>

              <!-- Top Stats Row -->
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Total Gain -->
                <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 rounded-xl p-4 text-center">
                  <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="simTotalGain">$0.00</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Total Gain</div>
                </div>
                <!-- Win Rate -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 rounded-xl p-4 text-center">
                  <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="simWinRate">0%</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Win Rate</div>
                </div>
                <!-- Gain/Loss Ratio -->
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/30 dark:to-purple-800/30 rounded-xl p-4 text-center">
                  <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="simGainLossRatio">0.00</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Gain/Loss Ratio</div>
                </div>
                <!-- Total Trades -->
                <div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700/30 dark:to-gray-600/30 rounded-xl p-4 text-center">
                  <div class="text-2xl font-bold text-gray-700 dark:text-gray-300" id="simTotalTrades">0</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Total Trades</div>
                </div>
              </div>

              <!-- Second Row: Win Rate Chart + Trade Distribution -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Win Rate Pie Chart -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                  <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-3">Win Rate</h4>
                  <div class="flex items-center justify-center">
                    <div id="winRateChart" class="relative w-32 h-32">
                      <svg viewBox="0 0 100 100" class="w-full h-full transform -rotate-90">
                        <circle cx="50" cy="50" r="40" fill="none" stroke="#e5e7eb" stroke-width="12" class="dark:stroke-gray-600"/>
                        <circle id="winRateCircle" cx="50" cy="50" r="40" fill="none" stroke="#22c55e" stroke-width="12" stroke-dasharray="0 251.2" stroke-linecap="round"/>
                      </svg>
                      <div class="absolute inset-0 flex items-center justify-center">
                        <span id="winRatePercent" class="text-xl font-bold text-gray-800 dark:text-white">0%</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Trade Distribution -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                  <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-3">Trade Distribution</h4>
                  <div class="space-y-2">
                    <div class="flex items-center justify-between">
                      <span class="text-sm text-green-600 dark:text-green-400">Winning</span>
                      <span id="simWinningTrades" class="font-medium text-green-600 dark:text-green-400">0</span>
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-sm text-gray-500">Neutral</span>
                      <span id="simNeutralTrades" class="font-medium text-gray-500">0</span>
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-sm text-red-600 dark:text-red-400">Losing</span>
                      <span id="simLosingTrades" class="font-medium text-red-600 dark:text-red-400">0</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Third Row: Gains/Losses + Average Trade -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Gains & Losses -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                  <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-3">Gains & Losses</h4>
                  <div class="space-y-3">
                    <div>
                      <div class="flex justify-between text-sm mb-1">
                        <span class="text-green-600 dark:text-green-400">Gains only</span>
                        <span id="simGainsOnly" class="font-medium text-green-600 dark:text-green-400">$0.00</span>
                      </div>
                      <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                        <div id="gainsBar" class="bg-green-500 h-2 rounded-full" style="width: 0%"></div>
                      </div>
                    </div>
                    <div>
                      <div class="flex justify-between text-sm mb-1">
                        <span class="text-red-600 dark:text-red-400">Losses only</span>
                        <span id="simLossesOnly" class="font-medium text-red-600 dark:text-red-400">$0.00</span>
                      </div>
                      <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                        <div id="lossesBar" class="bg-red-500 h-2 rounded-full" style="width: 0%"></div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Avg Gain Per Trade -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                  <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-3">Avg Gain Per Trade</h4>
                  <div class="text-center">
                    <div id="simAvgGain" class="text-2xl font-bold text-gray-800 dark:text-white mb-2">$0.00</div>
                    <div class="flex justify-center gap-4 text-xs">
                      <div>
                        <span class="text-green-600 dark:text-green-400">Best: </span>
                        <span id="simBestTrade" class="font-medium text-green-600 dark:text-green-400">$0.00</span>
                      </div>
                      <div>
                        <span class="text-red-600 dark:text-red-400">Worst: </span>
                        <span id="simWorstTrade" class="font-medium text-red-600 dark:text-red-400">$0.00</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Fourth Row: Drawdown + Time Stats -->
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600 text-center">
                  <div id="simMaxDrawdown" class="text-lg font-bold text-red-600 dark:text-red-400">$0.00</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Max Drawdown</div>
                </div>
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600 text-center">
                  <div id="simMaxRunup" class="text-lg font-bold text-green-600 dark:text-green-400">$0.00</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Max Runup</div>
                </div>
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600 text-center">
                  <div id="simTimeInMarket" class="text-lg font-bold text-blue-600 dark:text-blue-400">0%</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Time in Market</div>
                </div>
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600 text-center">
                  <div id="simAvgOrdersDay" class="text-lg font-bold text-purple-600 dark:text-purple-400">0</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Avg Orders/Day</div>
                </div>
              </div>

              <!-- Daily Performance Chart -->
              <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-3">Gross Performance (Daily)</h4>
                <div id="performanceChartContainer" class="h-48 flex items-end justify-around gap-1 px-2">
                  <!-- Bars will be injected here by JS -->
                </div>
              </div>

              <!-- Raw Data View -->
              <div class="bg-white dark:bg-gray-700/50 rounded-xl border border-gray-200 dark:border-gray-600">
                <button id="toggleRawDataBtn" class="w-full px-4 py-3 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-600/50 rounded-xl transition-colors">
                  <div class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                    </svg>
                    <h4 class="text-sm font-medium text-gray-600 dark:text-gray-400">Raw Data (JSON)</h4>
                  </div>
                  <svg id="rawDataChevron" class="w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                  </svg>
                </button>
                <div id="rawDataPanel" class="hidden px-4 pb-4">
                  <pre id="rawDataContent" class="max-h-96 overflow-auto p-4 bg-gray-900 text-green-400 rounded-lg font-mono text-xs whitespace-pre-wrap scrollbar-thin"></pre>
                </div>
              </div>
            </div>
          </div>

          <!-- AI Trading Tab Content -->
          <div id="botAiTradingTabContent" class="hidden">
            <div class="space-y-6">
              <!-- Header with Controls -->
              <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-800 dark:text-white flex items-center gap-2">
                  <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                  AI Strategy Engine
                </h3>
                <div class="flex items-center gap-2">
                  <select id="aiSymbol" class="px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                    <option value="silver" selected>Silver Futures</option>
                    <option value="gold">Gold Futures</option>
                    <option value="xagusd">Silver Spot</option>
                    <option value="xauusd">Gold Spot</option>
                    <option value="oil">Crude Oil WTI</option>
                    <option value="btcusd">Bitcoin</option>
                    <option value="eurusd">EUR/USD</option>
                    <option value="spx500">S&P 500</option>
                  </select>
                  <select id="aiSession" class="px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                    <option value="all" selected>All Sessions (Worldwide)</option>
                    <option value="auto">Auto-detect</option>
                    <option value="asia">Asia</option>
                    <option value="london">London</option>
                    <option value="newyork">New York</option>
                  </select>
                  <select id="aiCandleCount" class="px-3 py-1.5 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" title="Number of candles to analyze">
                    <option value="100">100 candles</option>
                    <option value="500">500 candles</option>
                    <option value="1000" selected>1k candles</option>
                    <option value="5000">5k candles</option>
                    <option value="10000">10k candles</option>
                    <option value="50000">50k candles</option>
                    <option value="100000">100k candles</option>
                    <option value="200000">200k candles</option>
                  </select>
                </div>
              </div>

              <!-- AI Sub-tabs -->
              <div class="flex items-center gap-2 border-b border-gray-200 dark:border-gray-600 pb-3">
                <button id="aiStrategySubTab" class="ai-sub-tab px-4 py-2 rounded-lg text-sm font-medium transition-colors bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 flex items-center gap-1.5">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                  AI Strategy
                </button>
                <button id="aiResultsSubTab" class="ai-sub-tab px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-1.5">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                  </svg>
                  AI Results
                </button>
                <button id="aiMemorySubTab" class="ai-sub-tab px-4 py-2 rounded-lg text-sm font-medium transition-colors text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-1.5">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                  AI Memory
                </button>
              </div>

              <!-- AI Strategy Sub-tab Content -->
              <div id="aiStrategyContent">
                <!-- Search Bar -->
                <div class="mb-4">
                  <div class="flex gap-2">
                    <input type="text" id="aiStrategySearch" placeholder="Search market idea or setup..." class="flex-1 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                    <button id="runAiAnalysis" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors flex items-center gap-2">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                      </svg>
                      Run AI
                    </button>
                  </div>
                </div>

                <!-- Filter Chips -->
                <div class="flex flex-wrap gap-2 mb-6">
                  <span class="px-3 py-1 text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full cursor-pointer hover:bg-blue-200 dark:hover:bg-blue-800/50">Trend</span>
                  <span class="px-3 py-1 text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full cursor-pointer hover:bg-green-200 dark:hover:bg-green-800/50">Mean Rev</span>
                  <span class="px-3 py-1 text-xs font-medium bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded-full cursor-pointer hover:bg-orange-200 dark:hover:bg-orange-800/50">Breakout</span>
                  <span class="px-3 py-1 text-xs font-medium bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-full cursor-pointer hover:bg-purple-200 dark:hover:bg-purple-800/50">London</span>
                  <span class="px-3 py-1 text-xs font-medium bg-pink-100 dark:bg-pink-900/30 text-pink-700 dark:text-pink-300 rounded-full cursor-pointer hover:bg-pink-200 dark:hover:bg-pink-800/50">NY</span>
                  <span class="px-3 py-1 text-xs font-medium bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 rounded-full cursor-pointer hover:bg-cyan-200 dark:hover:bg-cyan-800/50">Asia</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">1s</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">2s</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">3s</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">5s</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">10s</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">30s</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">1m</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">5m</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">15m</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">1h</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">4h</span>
                  <span class="px-3 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600">1d</span>
                </div>

                <!-- Market Context Card -->
                <div class="bg-gradient-to-r from-slate-50 to-gray-50 dark:from-gray-700/50 dark:to-gray-700/30 rounded-xl p-4 border border-gray-200 dark:border-gray-600 mb-4">
                  <div class="flex items-center justify-between mb-3">
                    <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                      <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                      Market Context
                    </h4>
                    <span class="text-xs text-gray-500 dark:text-gray-400">Auto-detected</span>
                  </div>
                  <div class="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
                    <div>
                      <span class="text-gray-500 dark:text-gray-400">Symbol:</span>
                      <span id="aiContextSymbol" class="ml-1 font-medium text-gray-800 dark:text-white">XAGUSD</span>
                    </div>
                    <div>
                      <span class="text-gray-500 dark:text-gray-400">Session:</span>
                      <span id="aiContextSession" class="ml-1 font-medium text-purple-600 dark:text-purple-400">London</span>
                    </div>
                    <div>
                      <span class="text-gray-500 dark:text-gray-400">Volatility:</span>
                      <span id="aiContextVolatility" class="ml-1 font-medium text-orange-600 dark:text-orange-400">Elevated</span>
                    </div>
                    <div>
                      <span class="text-gray-500 dark:text-gray-400">Regime:</span>
                      <span id="aiContextRegime" class="ml-1 font-medium text-gray-800 dark:text-white">Low Liquidity Fakeout</span>
                    </div>
                    <div>
                      <span class="text-gray-500 dark:text-gray-400">Structure:</span>
                      <span id="aiContextStructure" class="ml-1 font-medium text-gray-800 dark:text-white">M5 Reversal / H1 Range</span>
                    </div>
                    <div>
                      <span class="text-gray-500 dark:text-gray-400">Confidence:</span>
                      <span id="aiContextConfidence" class="ml-1 text-yellow-500">â—â—â—â—â—‹</span>
                    </div>
                  </div>
                </div>

                <!-- Strategy Hypotheses -->
                <div class="space-y-4 mb-4">
                  <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                    <svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                    AI Strategy Hypotheses
                  </h4>

                  <div id="aiHypothesesContainer" class="space-y-3">
                    <!-- Sample Hypothesis Card -->
                    <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-purple-200 dark:border-purple-700/50">
                      <div class="flex items-start justify-between mb-2">
                        <h5 class="font-medium text-gray-800 dark:text-white flex items-center gap-2">
                          <span class="w-2 h-2 bg-purple-500 rounded-full"></span>
                          London Fake Breakdown Reversal
                        </h5>
                        <span class="text-xs px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded">Long (M5)</span>
                      </div>
                      <div class="flex flex-wrap gap-1.5 mb-3">
                        <span class="px-2 py-0.5 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded">Trend</span>
                        <span class="px-2 py-0.5 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded">London</span>
                        <span class="px-2 py-0.5 text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded">Mean Reversion</span>
                      </div>
                      <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        <p class="mb-1"><strong>Rationale:</strong></p>
                        <ul class="list-disc list-inside text-xs space-y-0.5 ml-2">
                          <li>Asia low sweep detected</li>
                          <li>Volume absorption at key level</li>
                          <li>Historical match: 78 similar cases</li>
                        </ul>
                      </div>
                      <div class="flex items-center justify-between">
                        <div class="flex gap-2">
                          <button class="px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">+ Add to Bot</button>
                          <button class="px-3 py-1.5 text-xs bg-gray-100 dark:bg-gray-600 hover:bg-gray-200 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-200 rounded-lg transition-colors">Use</button>
                        </div>
                        <button class="text-xs text-purple-600 dark:text-purple-400 hover:underline flex items-center gap-1">
                          View Logic
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                          </svg>
                        </button>
                      </div>
                    </div>

                    <!-- Second Hypothesis -->
                    <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-orange-200 dark:border-orange-700/50">
                      <div class="flex items-start justify-between mb-2">
                        <h5 class="font-medium text-gray-800 dark:text-white flex items-center gap-2">
                          <span class="w-2 h-2 bg-orange-500 rounded-full"></span>
                          Breakout Continuation
                        </h5>
                        <span class="text-xs px-2 py-0.5 bg-gray-100 dark:bg-gray-600 text-gray-600 dark:text-gray-300 rounded">Neutral (H1)</span>
                      </div>
                      <div class="flex flex-wrap gap-1.5 mb-3">
                        <span class="px-2 py-0.5 text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded">Breakout</span>
                        <span class="px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded">H1</span>
                      </div>
                      <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        <p class="mb-1"><strong>Rationale:</strong></p>
                        <ul class="list-disc list-inside text-xs space-y-0.5 ml-2">
                          <li>Prior resistance now support</li>
                          <li>Momentum building on higher timeframe</li>
                          <li>Historical match: 42 similar cases</li>
                        </ul>
                      </div>
                      <div class="flex items-center justify-between">
                        <div class="flex gap-2">
                          <button class="px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">+ Add to Bot</button>
                          <button class="px-3 py-1.5 text-xs bg-gray-100 dark:bg-gray-600 hover:bg-gray-200 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-200 rounded-lg transition-colors">Use</button>
                        </div>
                        <button class="text-xs text-purple-600 dark:text-purple-400 hover:underline flex items-center gap-1">
                          View Logic
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Learning Feedback -->
                <div class="bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 rounded-xl p-4 border border-emerald-200 dark:border-emerald-700/50">
                  <h4 class="text-sm font-semibold text-emerald-700 dark:text-emerald-300 mb-3 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                    </svg>
                    Learning Feedback
                  </h4>
                  <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                    <div>
                      <span class="text-gray-500 dark:text-gray-400">Similar setups:</span>
                      <span id="aiLearningSetups" class="ml-1 font-medium text-gray-800 dark:text-white">214</span>
                    </div>
                    <div>
                      <span class="text-gray-500 dark:text-gray-400">Recent perf:</span>
                      <span id="aiLearningPerf" class="ml-1 font-medium text-orange-600 dark:text-orange-400">â†“ Slight decay</span>
                    </div>
                    <div>
                      <span class="text-gray-500 dark:text-gray-400">Adaptation:</span>
                      <span id="aiLearningAdapt" class="ml-1 font-medium text-emerald-600 dark:text-emerald-400">Wider targets</span>
                    </div>
                    <div>
                      <button class="text-xs text-purple-600 dark:text-purple-400 hover:underline">View History</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- AI Results Sub-tab Content -->
              <div id="aiResultsContent" class="hidden">
                <!-- Timeframe Selector -->
                <div class="flex items-center gap-2 mb-4">
                  <span class="text-sm text-gray-600 dark:text-gray-400">Timeframes:</span>
                  <div id="aiResultsTimeframeBtns" class="flex flex-wrap gap-1">
                    <button data-tf="1s" class="ai-tf-btn px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">1s</button>
                    <button data-tf="2s" class="ai-tf-btn px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">2s</button>
                    <button data-tf="3s" class="ai-tf-btn px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">3s</button>
                    <button data-tf="5s" class="ai-tf-btn px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">5s</button>
                    <button data-tf="10s" class="ai-tf-btn px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">10s</button>
                    <button data-tf="30s" class="ai-tf-btn px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">30s</button>
                    <button data-tf="1m" class="ai-tf-btn px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">1m</button>
                    <button data-tf="5m" class="ai-tf-btn px-2 py-1 text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 rounded-lg">5m</button>
                    <button data-tf="15m" class="ai-tf-btn px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">15m</button>
                    <button data-tf="1h" class="ai-tf-btn px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">1h</button>
                    <button data-tf="4h" class="ai-tf-btn px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">4h</button>
                    <button data-tf="1d" class="ai-tf-btn px-2 py-1 text-xs font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">1d</button>
                  </div>
                </div>

                <!-- AI Projection Graph -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600 mb-4">
                  <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                      <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300">AI Price Projection</h4>
                      <span id="projectionTimeframeLabel" class="px-2 py-0.5 text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 rounded">5m</span>
                      <span id="projectionDataInfo" class="text-xs text-gray-500 dark:text-gray-400"></span>
                      <button id="refreshProjectionChart" class="p-1.5 text-purple-600 dark:text-purple-400 hover:bg-purple-100 dark:hover:bg-purple-900/50 rounded-lg transition-colors" title="Refresh Chart">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                      </button>
                    </div>
                    <div class="flex items-center gap-4">
                      <!-- Back-Simulation Selector -->
                      <div class="flex items-center gap-2">
                        <label class="text-xs text-gray-500 dark:text-gray-400">Backtest:</label>
                        <select id="aiBacktestOffset" class="text-xs px-2 py-1 bg-gray-100 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded text-gray-700 dark:text-gray-200">
                          <option value="0" selected>Live (now)</option>
                          <option value="60">-1 min ago</option>
                          <option value="600">-10 min ago</option>
                          <option value="1800">-30 min ago</option>
                          <option value="3600">-1 hour ago</option>
                          <option value="14400">-4 hours ago</option>
                          <option value="43200">-12 hours ago</option>
                          <option value="86400">-1 day ago</option>
                          <option value="604800">-1 week ago</option>
                        </select>
                      </div>
                      <div class="flex items-center gap-2">
                        <label class="text-xs text-gray-500 dark:text-gray-400">Forecast:</label>
                        <select id="aiProjectionCandles" class="text-xs px-2 py-1 bg-gray-100 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded text-gray-700 dark:text-gray-200">
                          <option value="100">100 candles</option>
                          <option value="1000">1k candles</option>
                          <option value="10000" selected>10k candles</option>
                          <option value="100000">100k candles</option>
                          <option value="200000">200k candles</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Backtest Accuracy Summary -->
                  <div id="backtestAccuracySummary" class="hidden mb-3 p-3 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-lg border border-yellow-300 dark:border-yellow-700">
                    <div class="flex items-center justify-between">
                      <span class="text-sm font-medium text-gray-700 dark:text-gray-300">
                        <span class="text-yellow-600 dark:text-yellow-400">Backtest Mode:</span> Analyzing from <span id="backtestFromTime" class="font-bold">--</span>
                      </span>
                      <span id="backtestAccuracyBadge" class="px-3 py-1 rounded-full text-sm font-bold bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300">--</span>
                    </div>
                    <div class="grid grid-cols-4 gap-4 mt-2 text-xs">
                      <div class="text-center">
                        <div class="text-gray-500 dark:text-gray-400">Direction</div>
                        <div id="backtestDirResult" class="font-bold text-gray-700 dark:text-gray-300">--</div>
                      </div>
                      <div class="text-center">
                        <div class="text-gray-500 dark:text-gray-400">Predicted</div>
                        <div id="backtestPredicted" class="font-bold text-blue-600 dark:text-blue-400">--</div>
                      </div>
                      <div class="text-center">
                        <div class="text-gray-500 dark:text-gray-400">Actual</div>
                        <div id="backtestActual" class="font-bold text-green-600 dark:text-green-400">--</div>
                      </div>
                      <div class="text-center">
                        <div class="text-gray-500 dark:text-gray-400">Error</div>
                        <div id="backtestError" class="font-bold text-red-600 dark:text-red-400">--</div>
                      </div>
                    </div>
                  </div>
                  <div class="flex items-center justify-end mb-1 gap-2">
                    <label class="text-xs text-gray-400">Height:</label>
                    <input type="range" id="aiProjectionChartHeight" min="288" max="600" value="400" class="w-20 h-1 accent-purple-500">
                    <span id="aiProjectionChartHeightLabel" class="text-xs text-gray-400 w-8">400</span>
                  </div>
                  <div id="aiProjectionChart" class="bg-gray-900 rounded-lg border border-gray-700 relative z-0 overflow-hidden" style="height: 400px;"></div>
                  <div class="flex justify-center gap-6 text-xs mt-3 p-2 bg-gray-100 dark:bg-gray-800 rounded-lg">
                    <span class="flex items-center gap-2"><span class="w-4 h-0.5 bg-gray-400 rounded"></span> <span class="text-gray-600 dark:text-gray-300">Historical</span></span>
                    <span class="flex items-center gap-2"><span class="w-4 h-0.5 bg-green-500 rounded" style="border-top: 1px dashed #22c55e;"></span> <span class="text-gray-600 dark:text-gray-300">Bullish</span></span>
                    <span class="flex items-center gap-2"><span class="w-4 h-0.5 bg-red-500 rounded" style="border-top: 1px dashed #ef4444;"></span> <span class="text-gray-600 dark:text-gray-300">Bearish</span></span>
                    <span class="flex items-center gap-2"><span class="w-4 h-1 bg-blue-500 rounded"></span> <span class="font-medium text-blue-600 dark:text-blue-400">AI Projected</span></span>
                    <span class="flex items-center gap-2"><span class="w-4 h-1 rounded" style="background: #ff3333; box-shadow: 0 0 6px #ff3333;"></span> <span class="font-medium text-red-500">Real Price</span></span>
                  </div>
                  
                  <!-- AI Backtest Simulation Panel -->
                  <div id="aiBacktestPanel" class="mt-3 p-4 bg-gradient-to-r from-violet-50 to-purple-50 dark:from-violet-900/20 dark:to-purple-900/20 rounded-xl border border-violet-300 dark:border-violet-700">
                    <div class="flex items-center justify-between mb-3">
                      <div class="flex items-center gap-3">
                        <h4 class="text-sm font-bold text-gray-800 dark:text-gray-200">Backtest Simulation</h4>
                        <span id="backtestStatus" class="px-2 py-0.5 text-xs font-medium bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300 rounded-full">Ready</span>
                      </div>
                    </div>
                    
                    <!-- Backtest Settings Row 1 -->
                    <div class="grid grid-cols-4 gap-3 mb-2">
                      <div>
                        <label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">Cycles</label>
                        <select id="backtestCycles" class="w-full px-2 py-1.5 text-xs rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                          <option value="1">1 Cycle</option>
                          <option value="5">5 Cycles</option>
                          <option value="10" selected>10 Cycles</option>
                          <option value="25">25 Cycles</option>
                          <option value="50">50 Cycles</option>
                          <option value="100">100 Cycles</option>
                        </select>
                      </div>
                      <div>
                        <label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">Timeframe</label>
                        <select id="backtestTimeframe" class="w-full px-2 py-1.5 text-xs rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                          <option value="10s">10 sec</option>
                          <option value="1m">1 min</option>
                          <option value="5m">5 min</option>
                          <option value="15m">15 min</option>
                          <option value="1h" selected>1 hour</option>
                          <option value="4h">4 hour</option>
                          <option value="1d">Daily</option>
                          <option value="1w">Weekly</option>
                          <option value="1M">Monthly</option>
                        </select>
                      </div>
                      <div>
                        <label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">Exit Strategy</label>
                        <select id="backtestExitStrategy" class="w-full px-2 py-1.5 text-xs rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                          <option value="dynamic" selected>AI Dynamic</option>
                          <option value="trailing">Trailing Stop</option>
                          <option value="target">TP/SL Target</option>
                          <option value="reversal">Signal Reversal</option>
                        </select>
                      </div>
                      <div>
                        <label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">Trade Type</label>
                        <select id="backtestTradeType" class="w-full px-2 py-1.5 text-xs rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                          <option value="both" selected>Long & Short</option>
                          <option value="long">Long Only</option>
                          <option value="short">Short Only</option>
                        </select>
                      </div>
                    </div>
                    
                    <!-- Trading Settings Row -->
                    <div class="grid grid-cols-6 gap-2 mb-3 p-2 bg-white/50 dark:bg-gray-800/50 rounded-lg border border-violet-200 dark:border-violet-700/50">
                      <div>
                        <label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">Capital ($)</label>
                        <input type="number" id="backtestCapital" value="10000" min="100" step="100" class="w-full px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                      </div>
                      <div>
                        <label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">Position Size</label>
                        <input type="number" id="backtestPositionSize" value="1" min="0.01" step="0.01" class="w-full px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                      </div>
                      <div>
                        <label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">Max Size</label>
                        <input type="number" id="backtestMaxSize" value="10" min="0.1" step="0.1" class="w-full px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                      </div>
                      <div>
                        <label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">Order Fee ($)</label>
                        <input type="number" id="backtestOrderFee" value="2" min="0" step="0.5" class="w-full px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                      </div>
                      <div>
                        <label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">Spread ($)</label>
                        <input type="number" id="backtestSpread" value="0.02" min="0" step="0.01" class="w-full px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                      </div>
                      <div class="flex items-end">
                        <label class="flex items-center gap-1 text-xs text-gray-600 dark:text-gray-400 cursor-pointer py-1">
                          <input type="checkbox" id="backtestCumulate" class="w-3 h-3 rounded border-gray-300 text-violet-600 focus:ring-violet-500">
                          Cumulate
                        </label>
                      </div>
                    </div>
                    
                    <!-- Action Buttons Row -->
                    <div class="flex items-center gap-2 mb-3">
                      <button id="startBacktest" class="px-4 py-1.5 text-xs font-medium bg-violet-600 hover:bg-violet-700 text-white rounded-lg transition-colors flex items-center justify-center gap-1">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        Run Backtest
                      </button>
                    </div>
                    
                    <!-- Optimization Controls -->
                    <div class="flex items-center gap-2 mb-3 flex-wrap">
                      <button id="startContinuousBtn" class="px-3 py-1.5 text-xs font-medium bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors flex items-center gap-1">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                        Continuous
                      </button>
                      <button id="runUntilProfitBtn" class="px-3 py-1.5 text-xs font-medium bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-colors flex items-center gap-1">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/></svg>
                        Until Profit
                      </button>
                      <button id="autoOptimizeBtn" class="px-3 py-1.5 text-xs font-medium bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors flex items-center gap-1">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
                        Auto-Optimize
                      </button>
                      <label class="flex items-center gap-1 text-xs text-gray-600 dark:text-gray-400 cursor-pointer">
                        <input type="checkbox" id="useLearnedParams" class="w-3 h-3 rounded border-gray-300 text-violet-600 focus:ring-violet-500">
                        Use Learned
                      </label>
                      <label class="flex items-center gap-1 text-xs text-gray-600 dark:text-gray-400 cursor-pointer">
                        <input type="checkbox" id="randomizeParams" class="w-3 h-3 rounded border-gray-300 text-violet-600 focus:ring-violet-500" checked>
                        Random Params
                      </label>
                      <div id="continuousControls" class="hidden flex items-center gap-2 ml-auto">
                        <div class="text-xs text-gray-600 dark:text-gray-400">
                          Iterations: <span id="continuousIterations" class="font-bold text-violet-600">0</span>
                          | Best: <span id="continuousBestPnL" class="font-bold text-emerald-600">$0.00</span>
                        </div>
                        <button id="stopContinuousBtn" class="px-3 py-1.5 text-xs font-medium bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors flex items-center gap-1">
                          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M6 6h12v12H6z"/></svg>
                          Stop
                        </button>
                      </div>
                    </div>
                    
                    <!-- Current Parameters Display -->
                    <div id="currentParamsDisplay" class="mb-3 p-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-xs">
                      <div class="flex items-center justify-between mb-1">
                        <span class="font-medium text-gray-700 dark:text-gray-300">Current Parameters:</span>
                        <span id="paramSource" class="text-violet-600 dark:text-violet-400">Default</span>
                      </div>
                      <div class="grid grid-cols-3 gap-1 text-gray-600 dark:text-gray-400">
                        <span>TP: <span id="dispTP" class="font-mono text-gray-800 dark:text-gray-200">1.5%</span></span>
                        <span>SL: <span id="dispSL" class="font-mono text-gray-800 dark:text-gray-200">1.0%</span></span>
                        <span>Trail: <span id="dispTrail" class="font-mono text-gray-800 dark:text-gray-200">0.8%</span></span>
                        <span>ATRÃ—: <span id="dispATR" class="font-mono text-gray-800 dark:text-gray-200">2.0</span></span>
                        <span>RSI: <span id="dispRSI" class="font-mono text-gray-800 dark:text-gray-200">30/70</span></span>
                        <span>Size: <span id="dispSize" class="font-mono text-gray-800 dark:text-gray-200">0.05</span></span>
                      </div>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div id="backtestProgressContainer" class="hidden mb-3">
                      <div class="flex items-center justify-between text-xs text-gray-600 dark:text-gray-400 mb-1">
                        <span id="backtestProgressLabel">Cycle 0 / 0</span>
                        <span id="backtestProgressPct">0%</span>
                      </div>
                      <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div id="backtestProgressBar" class="h-full bg-gradient-to-r from-violet-500 to-purple-500 transition-all duration-300" style="width: 0%"></div>
                      </div>
                    </div>
                    
                    <!-- Backtest Results -->
                    <div id="backtestResults" class="hidden">
                      <div class="grid grid-cols-5 gap-2 text-xs mb-3">
                        <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2 text-center">
                          <div class="text-gray-500 dark:text-gray-400">Trades</div>
                          <div id="btTotalTrades" class="font-bold text-gray-800 dark:text-gray-200">0</div>
                        </div>
                        <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2 text-center">
                          <div class="text-gray-500 dark:text-gray-400">Win Rate</div>
                          <div id="btWinRate" class="font-bold text-gray-600">--%</div>
                        </div>
                        <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2 text-center">
                          <div class="text-gray-500 dark:text-gray-400">Total P/L</div>
                          <div id="btTotalPnL" class="font-bold text-gray-600">$0</div>
                        </div>
                        <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2 text-center">
                          <div class="text-gray-500 dark:text-gray-400">Avg Trade</div>
                          <div id="btAvgTrade" class="font-bold text-gray-600">$0</div>
                        </div>
                        <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2 text-center">
                          <div class="text-gray-500 dark:text-gray-400">Best Cycle</div>
                          <div id="btBestCycle" class="font-bold text-emerald-600">$0</div>
                        </div>
                      </div>
                      
                      <!-- Backtest Chart with Trade Markers -->
                      <div class="mb-3">
                        <div class="flex items-center justify-between mb-2">
                          <span class="text-xs font-medium text-gray-700 dark:text-gray-300">Trade Chart</span>
                          <div class="flex items-center gap-3 text-xs">
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-emerald-500"></span> Long Entry</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-500"></span> Short Entry</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-gray-400"></span> Exit</span>
                          </div>
                        </div>
                        <div id="backtestChart" class="h-64 bg-slate-900 rounded-lg border border-slate-700" style="min-width: 300px;"></div>
                      </div>
                      
                      <!-- Trade List -->
                      <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-medium text-gray-700 dark:text-gray-300">Trade History</span>
                        <button id="downloadBacktestJson" class="px-2 py-1 text-xs font-medium bg-violet-600 hover:bg-violet-700 text-white rounded transition-colors flex items-center gap-1">
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                          </svg>
                          Download JSON
                        </button>
                      </div>
                      <div id="backtestTradeList" class="max-h-40 overflow-y-auto bg-white/30 dark:bg-gray-800/30 rounded-lg border border-gray-300 dark:border-gray-600">
                        <table class="w-full text-xs">
                          <thead class="sticky top-0 bg-gray-100 dark:bg-gray-700">
                            <tr class="text-gray-600 dark:text-gray-300">
                              <th class="px-2 py-1 text-left">#</th>
                              <th class="px-2 py-1 text-left">Type</th>
                              <th class="px-2 py-1 text-right">Entry</th>
                              <th class="px-2 py-1 text-right">Exit</th>
                              <th class="px-2 py-1 text-right">P/L</th>
                              <th class="px-2 py-1 text-left">Time</th>
                            </tr>
                          </thead>
                          <tbody id="backtestTradeListBody" class="divide-y divide-gray-200 dark:divide-gray-600">
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                  
                  <!-- AI Query Panel -->
                  <div id="aiQueryPanel" class="mt-3 p-4 bg-gradient-to-r from-cyan-50 to-blue-50 dark:from-cyan-900/20 dark:to-blue-900/20 rounded-xl border border-cyan-300 dark:border-cyan-700">
                    <div class="flex items-center gap-3 mb-3">
                      <svg class="w-5 h-5 text-cyan-600" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                      <h4 class="text-sm font-bold text-gray-800 dark:text-gray-200">Ask AI Brain</h4>
                      <span class="text-xs text-gray-500 dark:text-gray-400">Get predictions based on learned patterns</span>
                    </div>
                    <div class="flex gap-2 mb-3">
                      <input type="text" id="aiQueryInput" 
                        placeholder="e.g., 'What's the price at 10:30 Sydney time?' or 'Show me next hour projection'" 
                        class="flex-1 px-3 py-2 text-sm rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-400 focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
                      <button id="aiQueryBtn" class="px-4 py-2 text-sm font-medium bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                        Ask
                      </button>
                    </div>
                    <div id="aiQueryLoading" class="hidden flex items-center gap-2 text-sm text-gray-500 mb-3">
                      <svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke-width="4" class="opacity-25"></circle><path d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" fill="currentColor" class="opacity-75"></path></svg>
                      Thinking...
                    </div>
                    <div id="aiQueryResult" class="p-3 bg-white/50 dark:bg-gray-800/50 rounded-lg min-h-[60px]">
                      <div class="text-sm text-gray-500 dark:text-gray-400 italic">Ask a question to get AI predictions based on brain memory and market data...</div>
                    </div>
                  </div>
                  
                  <!-- AI Trading Panel -->
                  <div id="aiTradesPanel" class="mt-3 p-4 bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 rounded-xl border border-emerald-300 dark:border-emerald-700">
                    <div class="flex items-center justify-between mb-3">
                      <div class="flex items-center gap-3">
                        <h4 class="text-sm font-bold text-gray-800 dark:text-gray-200">AI Trading</h4>
                        <span id="aiTradeStatus" class="px-2 py-0.5 text-xs font-medium bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300 rounded-full">Stopped</span>
                        <span id="aiTradeSignal" class="hidden px-3 py-1 text-xs font-bold rounded-full animate-pulse"></span>
                      </div>
                      <div class="flex items-center gap-2">
                        <button id="startAiTrading" class="px-3 py-1.5 text-xs font-medium bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors flex items-center gap-1">
                          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                          Start
                        </button>
                        <button id="stopAiTrading" class="hidden px-3 py-1.5 text-xs font-medium bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors flex items-center gap-1">
                          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12"/></svg>
                          Stop
                        </button>
                        <button id="resetAiTrading" class="px-3 py-1.5 text-xs font-medium bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors">Reset</button>
                      </div>
                    </div>
                    
                    <!-- Trading Stats Grid -->
                    <div class="grid grid-cols-5 gap-3 mb-3">
                      <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2 text-center">
                        <div class="text-xs text-gray-500 dark:text-gray-400">Capital</div>
                        <div id="aiTradeCapital" class="text-sm font-bold text-gray-800 dark:text-gray-200">$2,000</div>
                      </div>
                      <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2 text-center">
                        <div class="text-xs text-gray-500 dark:text-gray-400">P/L</div>
                        <div id="aiTradePnL" class="text-sm font-bold text-gray-600">$0.00</div>
                      </div>
                      <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2 text-center">
                        <div class="text-xs text-gray-500 dark:text-gray-400">Win Rate</div>
                        <div id="aiTradeWinRate" class="text-sm font-bold text-gray-600">--%</div>
                      </div>
                      <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2 text-center">
                        <div class="text-xs text-gray-500 dark:text-gray-400">Trades</div>
                        <div id="aiTradeCount" class="text-sm font-bold text-gray-600">0</div>
                      </div>
                      <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2 text-center">
                        <div class="text-xs text-gray-500 dark:text-gray-400">Position</div>
                        <div id="aiTradePosition" class="text-sm font-bold text-gray-500">None</div>
                      </div>
                    </div>
                    
                    <!-- Learning & Confidence Stats -->
                    <div class="grid grid-cols-3 gap-3 mb-3">
                      <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                        <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Learning Score</div>
                        <div class="flex items-center gap-2">
                          <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div id="aiLearningBar" class="h-full bg-gradient-to-r from-purple-500 to-blue-500 transition-all" style="width: 0%"></div>
                          </div>
                          <span id="aiLearningScore" class="text-xs font-bold text-purple-600 dark:text-purple-400">0</span>
                        </div>
                      </div>
                      <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                        <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">News Sentiment</div>
                        <div id="aiNewsSentiment" class="text-xs font-medium text-gray-600 dark:text-gray-300">Checking...</div>
                      </div>
                      <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                        <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Market Speed</div>
                        <div id="aiMarketSpeed" class="text-xs font-medium text-gray-600 dark:text-gray-300">Normal</div>
                      </div>
                    </div>
                    
                    <!-- Trade History List -->
                    <div class="bg-white/30 dark:bg-gray-800/30 rounded-lg overflow-hidden">
                      <div class="flex items-center justify-between px-3 py-2 bg-gray-100 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-600">
                        <span class="text-xs font-medium text-gray-600 dark:text-gray-400">Recent Trades</span>
                        <span id="aiTradeListCount" class="text-xs text-gray-500 dark:text-gray-400">0 trades</span>
                      </div>
                      <div id="aiTradeList" class="max-h-32 overflow-y-auto text-xs">
                        <div class="p-3 text-center text-gray-500 dark:text-gray-400 italic">No trades yet - click Start to begin AI trading</div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- AI Chat Panel -->
                  <div id="aiChatPanel" class="mt-3 p-4 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 rounded-xl border border-purple-300 dark:border-purple-700">
                    <div class="flex items-center justify-between mb-3">
                      <div class="flex items-center gap-2">
                        <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                        </svg>
                        <h4 class="text-sm font-bold text-gray-800 dark:text-gray-200">Chat with AI</h4>
                        <span class="px-2 py-0.5 text-xs bg-purple-200 dark:bg-purple-700 text-purple-700 dark:text-purple-200 rounded-full">Claude</span>
                      </div>
                      <button id="clearAiChat" class="text-xs text-gray-500 hover:text-red-500 transition-colors">Clear</button>
                    </div>
                    
                    <!-- Chat Messages -->
                    <div id="aiChatMessages" class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-3 h-48 overflow-y-auto mb-3 space-y-3">
                      <div class="text-center text-xs text-gray-500 dark:text-gray-400 italic py-4">
                        Ask me about trading strategies, market analysis, or discuss your ideas...
                      </div>
                    </div>
                    
                    <!-- Chat Input -->
                    <div class="flex gap-2">
                      <textarea id="aiChatInput" rows="2" class="flex-1 px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none" placeholder="Type your question or idea..."></textarea>
                      <button id="sendAiChat" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors flex items-center gap-1 self-end">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                        </svg>
                        Send
                      </button>
                    </div>
                    
                    <!-- Contract Info -->
                    <div class="mt-2 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                      <span>Silver Contract: Min 0.05, 100/point, 1pt = $1 AUD</span>
                      <span id="aiTradeLastCheck" class="italic">Last analysis: --</span>
                    </div>
                  </div>
                  
                  <!-- Accuracy Display -->
                  <div id="aiPredictionAccuracy" class="mt-3 p-3 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg border border-purple-200 dark:border-purple-700">
                    <div class="flex items-center justify-between">
                      <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Prediction Accuracy</span>
                      <span id="aiAccuracyValue" class="text-lg font-bold text-purple-600 dark:text-purple-400">--</span>
                    </div>
                    <div class="flex gap-4 mt-2 text-xs text-gray-600 dark:text-gray-400">
                      <span>Projected: <strong id="aiProjectedPrice" class="text-blue-600">--</strong></span>
                      <span>Actual: <strong id="aiActualPrice" class="text-red-500">--</strong></span>
                      <span>Deviation: <strong id="aiPriceDeviation">--</strong></span>
                    </div>
                  </div>
                  
                  <!-- Projection List View -->
                  <div class="mt-4">
                    <button id="toggleProjectionList" class="w-full flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                      <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Projection Data (List View)</span>
                      <svg id="projectionListChevron" class="w-5 h-5 text-gray-500 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                      </svg>
                    </button>
                    <div id="projectionListPanel" class="hidden mt-2 h-[300px] overflow-y-auto bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600">
                      <table class="w-full text-xs">
                        <thead class="sticky top-0 bg-gray-100 dark:bg-gray-700">
                          <tr class="text-left text-gray-600 dark:text-gray-300">
                            <th class="p-2">Time</th>
                            <th class="p-2">Projected</th>
                            <th class="p-2">Bullish</th>
                            <th class="p-2">Bearish</th>
                            <th class="p-2">Actual</th>
                            <th class="p-2">Accuracy</th>
                          </tr>
                        </thead>
                        <tbody id="projectionListBody" class="divide-y divide-gray-200 dark:divide-gray-600">
                          <tr><td colspan="6" class="p-4 text-center text-gray-500">Run AI analysis to see projection data</td></tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <!-- Directional Bias -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600 mb-4">
                  <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Directional Bias</h4>
                  <div id="aiDirectionalBias" class="space-y-2">
                    <div class="flex items-center justify-between">
                      <span class="text-sm text-gray-600 dark:text-gray-400">M5</span>
                      <div class="flex items-center gap-2">
                        <span class="text-sm font-medium text-gray-500">--</span>
                        <span class="text-gray-400">â—‹â—‹â—‹â—‹â—‹</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Price Targets Table -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600 mb-4">
                  <h4 id="aiPriceTargetsTitle" class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Price Targets (M5)</h4>
                  <table class="w-full text-sm">
                    <thead>
                      <tr class="text-left text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-600">
                        <th class="pb-2">Target</th>
                        <th class="pb-2">Probability</th>
                        <th class="pb-2">Outcome</th>
                      </tr>
                    </thead>
                    <tbody id="aiPriceTargetsBody" class="divide-y divide-gray-100 dark:divide-gray-600">
                      <tr>
                        <td class="py-2 text-gray-500">--</td>
                        <td class="py-2 text-gray-500">--</td>
                        <td class="py-2 text-gray-500">--</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Probability Curve -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600 mb-4">
                  <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Probability Curve</h4>
                  <div id="aiProbabilityCurve" class="h-32 flex items-end justify-center px-8">
                    <svg viewBox="0 0 200 80" class="w-full h-full" preserveAspectRatio="xMidYMid meet">
                      <defs>
                        <linearGradient id="curveGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                          <stop offset="0%" style="stop-color:rgb(147, 51, 234);stop-opacity:0.3" />
                          <stop offset="100%" style="stop-color:rgb(147, 51, 234);stop-opacity:0.05" />
                        </linearGradient>
                      </defs>
                      <path d="M 10 70 Q 50 70 70 50 Q 90 30 100 20 Q 110 30 130 50 Q 150 70 190 70" stroke="rgb(147, 51, 234)" stroke-width="2" fill="none"/>
                      <path d="M 10 70 Q 50 70 70 50 Q 90 30 100 20 Q 110 30 130 50 Q 150 70 190 70 L 190 70 L 10 70 Z" fill="url(#curveGradient)"/>
                      <text x="20" y="78" class="fill-gray-400" style="font-size: 8px">--</text>
                      <text x="95" y="78" class="fill-gray-400" style="font-size: 8px">0</text>
                      <text x="170" y="78" class="fill-gray-400" style="font-size: 8px">--</text>
                    </svg>
                  </div>
                  <div id="aiProbabilityStats" class="flex justify-center gap-6 text-xs text-gray-500 dark:text-gray-400 mt-2">
                    <span>Skew: <strong id="aiProbSkew" class="text-gray-400">--</strong></span>
                    <span>Confidence: <strong id="aiProbConfidence" class="text-purple-600 dark:text-purple-400">--</strong></span>
                  </div>
                </div>

                <!-- ProRealTime Output -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl border border-gray-200 dark:border-gray-600">
                  <button id="toggleAiPrtCode" class="w-full px-4 py-3 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-600/50 rounded-t-xl transition-colors">
                    <div class="flex items-center gap-2">
                      <svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                      </svg>
                      <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">ProRealTime Strategy Output</h4>
                    </div>
                    <svg id="aiPrtChevron" class="w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                  </button>
                  <div id="aiPrtCodePanel" class="hidden px-4 pb-4">
                    <pre class="p-4 bg-gray-900 text-green-400 rounded-lg font-mono text-xs overflow-x-auto">DEFPARAM CumulateOrders = False

IF NOT OnMarket THEN
  IF Close CROSSES OVER VWAP THEN
    BUY 1 CONTRACT AT MARKET
  ENDIF
ENDIF

SET STOP pLOSS ATR(14) * 1.2</pre>
                    <div class="flex gap-2 mt-3">
                      <button class="px-3 py-1.5 text-xs bg-gray-100 dark:bg-gray-600 hover:bg-gray-200 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-200 rounded-lg transition-colors flex items-center gap-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                        </svg>
                        Copy
                      </button>
                      <button class="px-3 py-1.5 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">+ Add to Bot</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- AI Memory Sub-tab Content -->
              <div id="aiMemoryContent" class="hidden">
                <!-- Brain Status Header -->
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center gap-3">
                    <select id="aiMemoryAsset" class="px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm">
                      <option value="silver">Silver (XAGUSD)</option>
                      <option value="gold">Gold (XAUUSD)</option>
                    </select>
                    <button id="refreshAiMemory" class="px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                      </svg>
                      Refresh
                    </button>
                  </div>
                </div>

                <!-- Brain Status Panel -->
                <div class="bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 rounded-xl p-4 border border-purple-200 dark:border-purple-700 mb-4">
                  <div class="flex items-center justify-between mb-3">
                    <h4 class="text-sm font-semibold text-purple-700 dark:text-purple-300 flex items-center gap-2">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                      </svg>
                      AI Brain Status
                    </h4>
                    <div class="flex items-center gap-3">
                      <button id="observeToggle" class="px-3 py-1.5 text-xs font-medium rounded-lg transition-all flex items-center gap-1.5 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-green-500 hover:text-white">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                        </svg>
                        <span id="observeLabel">Observe</span>
                      </button>
                      <span id="brainLastUpdated" class="text-xs text-gray-500 dark:text-gray-400">Never updated</span>
                    </div>
                  </div>
                  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                      <div id="brainAccuracy" class="text-2xl font-bold text-purple-600 dark:text-purple-400">0%</div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">Accuracy</div>
                    </div>
                    <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                      <div id="brainPredictions" class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">0</div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">Predictions</div>
                    </div>
                    <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                      <div id="brainPatterns" class="text-2xl font-bold text-blue-600 dark:text-blue-400">0</div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">Patterns Learned</div>
                    </div>
                    <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                      <div id="brainConfidence" class="text-2xl font-bold text-green-600 dark:text-green-400">0%</div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">Confidence</div>
                    </div>
                  </div>
                  
                  <!-- Top Patterns -->
                  <div class="mt-4">
                    <h5 class="text-xs font-medium text-gray-600 dark:text-gray-400 mb-2">Top Learned Patterns</h5>
                    <div id="brainTopPatterns" class="flex flex-wrap gap-2">
                      <span class="text-xs text-gray-500 italic">No patterns learned yet</span>
                    </div>
                  </div>

                  <!-- Recent Memory -->
                  <div class="mt-4">
                    <h5 class="text-xs font-medium text-gray-600 dark:text-gray-400 mb-2">Recent Predictions</h5>
                    <div id="brainRecentMemory" class="space-y-1 max-h-32 overflow-y-auto">
                      <span class="text-xs text-gray-500 italic">No predictions yet</span>
                    </div>
                  </div>
                </div>

                <!-- Pattern Map Visualization -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600 mb-4">
                  <div class="flex items-center justify-between mb-3">
                    <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                      <svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                      </svg>
                      Pattern Performance Map
                    </h4>
                    <div class="flex items-center gap-2">
                      <span class="text-xs text-gray-500">Profitable</span>
                      <div class="flex gap-0.5">
                        <div class="w-3 h-3 bg-green-200 rounded-sm"></div>
                        <div class="w-3 h-3 bg-green-400 rounded-sm"></div>
                        <div class="w-3 h-3 bg-green-600 rounded-sm"></div>
                      </div>
                      <span class="text-xs text-gray-500 ml-2">Losing</span>
                      <div class="flex gap-0.5">
                        <div class="w-3 h-3 bg-red-200 rounded-sm"></div>
                        <div class="w-3 h-3 bg-red-400 rounded-sm"></div>
                        <div class="w-3 h-3 bg-red-600 rounded-sm"></div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Pattern Heatmap Grid -->
                  <div id="patternMapGrid" class="grid gap-1 mb-4">
                    <p class="text-xs text-gray-500 italic col-span-full text-center py-4">Run backtests or auto-optimize to build pattern data</p>
                  </div>
                  
                  <!-- Top 10 Best Patterns -->
                  <div class="border-t border-gray-200 dark:border-gray-600 pt-3 mt-3">
                    <div class="flex items-center justify-between mb-2">
                      <h5 class="text-xs font-medium text-gray-600 dark:text-gray-400 flex items-center gap-2">
                        <span>Top 10 Most Profitable Patterns</span>
                        <span class="text-green-600">$</span>
                      </h5>
                      <button id="viewAllPatternsBtn" class="px-2 py-1 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors">View All</button>
                    </div>
                    <div id="topProfitablePatterns" class="space-y-2 max-h-96 overflow-y-auto">
                      <p class="text-xs text-gray-500 italic">No profitable patterns yet</p>
                    </div>
                  </div>
                  
                  <!-- Pattern Stats Summary -->
                  <div class="grid grid-cols-4 gap-2 mt-3 pt-3 border-t border-gray-200 dark:border-gray-600">
                    <div class="text-center p-2 bg-gray-50 dark:bg-gray-800 rounded">
                      <div id="patternTotalPnL" class="text-sm font-bold text-green-600">$0</div>
                      <div class="text-xs text-gray-500">Total P/L</div>
                    </div>
                    <div class="text-center p-2 bg-gray-50 dark:bg-gray-800 rounded">
                      <div id="patternAvgWinRate" class="text-sm font-bold text-blue-600">0%</div>
                      <div class="text-xs text-gray-500">Avg Win Rate</div>
                    </div>
                    <div class="text-center p-2 bg-gray-50 dark:bg-gray-800 rounded">
                      <div id="patternTotalTrades" class="text-sm font-bold text-purple-600">0</div>
                      <div class="text-xs text-gray-500">Total Trades</div>
                    </div>
                    <div class="text-center p-2 bg-gray-50 dark:bg-gray-800 rounded">
                      <div id="patternBestSession" class="text-sm font-bold text-orange-600">--</div>
                      <div class="text-xs text-gray-500">Best Session</div>
                    </div>
                  </div>
                </div>

                <!-- Cross-Asset Correlations -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600 mb-4">
                  <div class="flex items-center justify-between mb-3">
                    <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                      <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
                      </svg>
                      Cross-Asset Correlations
                    </h4>
                    <button id="updateCorrelations" class="text-xs text-purple-600 dark:text-purple-400 hover:underline">Update Ratios</button>
                  </div>
                  <div id="correlationsList" class="space-y-3">
                    <!-- Gold-Silver Ratio -->
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                      <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center">
                          <span class="text-lg">ðŸ¥‡</span>
                        </div>
                        <div>
                          <div class="text-sm font-medium text-gray-800 dark:text-white">Gold/Silver Ratio</div>
                          <div class="text-xs text-gray-500 dark:text-gray-400">Correlation: 0.92</div>
                        </div>
                      </div>
                      <div class="text-right">
                        <div id="goldSilverRatio" class="text-xl font-bold text-gray-800 dark:text-white">88.5</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">Avg: 80.0</div>
                      </div>
                    </div>
                    <!-- Gold vs S&P 500 -->
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                      <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center">
                          <span class="text-lg">ðŸ“Š</span>
                        </div>
                        <div>
                          <div class="text-sm font-medium text-gray-800 dark:text-white">Gold vs S&P 500</div>
                          <div class="text-xs text-gray-500 dark:text-gray-400">Correlation: -0.25</div>
                        </div>
                      </div>
                      <div class="text-right">
                        <div id="goldSp500Ratio" class="text-xl font-bold text-gray-800 dark:text-white">0.41</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">Inverse</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- News & Events Archive -->
                <div class="bg-white dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                  <div class="flex items-center justify-between mb-3">
                    <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                      <svg class="w-4 h-4 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
                      </svg>
                      News & Events Archive
                    </h4>
                    <div class="flex items-center gap-2">
                      <label class="flex items-center gap-1 text-xs text-gray-600 dark:text-gray-400 cursor-pointer">
                        <input type="checkbox" id="checkDailyNews" class="w-3 h-3 text-purple-600 rounded">
                        <span>Check Daily</span>
                      </label>
                      <button id="checkOnlineNews" class="px-2 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors flex items-center gap-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        Check Online
                      </button>
                      <button id="addNewEvent" class="px-2 py-1 text-xs bg-purple-600 hover:bg-purple-700 text-white rounded transition-colors">+ Add Event</button>
                    </div>
                  </div>
                  <div id="eventsArchive" class="space-y-2 max-h-64 overflow-y-auto">
                    <!-- Sample event -->
                    <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border-l-4 border-blue-500">
                      <div class="flex items-center justify-between mb-1">
                        <span class="text-xs font-medium text-blue-600 dark:text-blue-400">Central Bank</span>
                        <span class="text-xs text-gray-500">Mar 15, 2024</span>
                      </div>
                      <h5 class="text-sm font-medium text-gray-800 dark:text-white mb-1">Fed Interest Rate Decision</h5>
                      <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">Federal Reserve held rates steady at 5.25-5.50%</p>
                      <div class="flex items-center gap-2 flex-wrap">
                        <span class="px-2 py-0.5 text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded">Silver +2.41%</span>
                        <span class="px-2 py-0.5 text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded">Gold +1.23%</span>
                      </div>
                      <p class="text-xs text-purple-600 dark:text-purple-400 mt-2 italic">AI: Dovish Fed stance typically bullish for precious metals</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Bot Output Section -->
        <section id="botOutputSection" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Generated Bot Code</h3>
              <div class="flex items-center gap-2">
                <button id="copyBotCode" class="px-4 py-2 text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors flex items-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                  </svg>
                  Copy
                </button>
                <button id="saveBotCode" class="px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                  </svg>
                  Save
                </button>
              </div>
            </div>
            
            <pre id="botCodeOutput" class="max-h-96 overflow-y-auto p-4 bg-gray-900 text-green-400 rounded-lg font-mono text-sm whitespace-pre-wrap scrollbar-thin"></pre>

            <!-- Variable Adjustment Panel (in code section) -->
            <div id="codeVariablePanel" class="hidden mt-4 p-4 bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-lg border border-indigo-200 dark:border-indigo-700">
              <div class="flex items-center justify-between mb-3">
                <h4 class="text-sm font-semibold text-indigo-700 dark:text-indigo-300 flex items-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                  </svg>
                  Adjust Variables (updates code above)
                </h4>
                <button id="resetVariablesBtn" class="px-2 py-1 text-xs bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-300 rounded transition-colors">
                  Reset All
                </button>
              </div>
              <div id="codeVariableSlidersContainer" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <!-- Sliders will be injected here -->
              </div>
            </div>

            <!-- Error Correction -->
            <div class="border-t border-gray-200 dark:border-gray-600 pt-4 mt-4">
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Got an error? Paste it here to fix:</label>
              <textarea id="botErrorInput" rows="3" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 resize-y font-mono text-sm" placeholder="Paste ProRealTime error message here..."></textarea>
              <button id="fixBotError" class="mt-2 w-full py-2 px-4 bg-orange-500 hover:bg-orange-600 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                Fix Error & Regenerate
              </button>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Right Sidebar - Saved Prompts (Text Tab) -->
    <aside id="promptsSidebar" class="fixed lg:static inset-y-0 right-0 z-40 w-72 bg-white dark:bg-gray-800 border-l border-gray-200 dark:border-gray-700 transform translate-x-full lg:translate-x-0 transition-transform duration-300 flex flex-col hidden">
      <div class="p-4 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Saved Prompts</h2>
      </div>
      <div id="promptsList" class="flex-1 overflow-y-auto p-2 space-y-2 scrollbar-thin">
        <p class="text-sm text-gray-500 dark:text-gray-400 p-2">No saved prompts yet</p>
      </div>
    </aside>

    <!-- Right Sidebar - AI Strategy History (Bot Builder Tab) -->
    <aside id="aiStrategySidebar" class="fixed lg:static inset-y-0 right-0 z-40 w-72 bg-white dark:bg-gray-800 border-l border-gray-200 dark:border-gray-700 transform translate-x-full lg:translate-x-0 transition-transform duration-300 flex flex-col">
      <div class="p-4 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-200 flex items-center gap-2">
          <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
          AI Results
        </h2>
      </div>
      <div id="aiStrategyHistoryList" class="flex-1 overflow-y-auto p-2 space-y-2 scrollbar-thin">
        <p class="text-sm text-gray-500 dark:text-gray-400 p-2">Run AI analysis to see results here</p>
      </div>
    </aside>

    <!-- Overlay for mobile (right) -->
    <div id="overlayRight" class="fixed inset-0 bg-black/50 z-30 hidden lg:hidden"></div>
  </div>

  <!-- Summary Preview Modal -->
  <div id="summaryPreviewModal" class="fixed inset-0 bg-black/50 z-[100] hidden items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden">
      <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
          <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          Bot Generation Summary
        </h3>
        <button id="closeSummaryModal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div id="summaryPreviewContent" class="p-4 overflow-y-auto max-h-[70vh] space-y-4">
        <!-- Content will be dynamically generated -->
      </div>
      <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3">
        <button id="closeSummaryBtn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 font-medium">Close</button>
        <button id="generateFromSummaryBtn" class="px-6 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-medium rounded-lg transition-colors flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
          </svg>
          Generate Bot
        </button>
      </div>
    </div>
  </div>

  <!-- Strategy Ideas Modal (moved to body level for proper fixed positioning) -->
  <div id="strategyIdeasModalGlobal" class="fixed inset-0 bg-black/50 z-[100] hidden items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
      <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
          <svg class="w-6 h-6 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
          Strategy Ideas from ProRealCode
        </h3>
        <button id="closeStrategyModalGlobal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="border-b border-gray-200 dark:border-gray-700">
        <div class="flex">
          <button id="ideasSearchTab" class="flex-1 px-6 py-3 text-sm font-medium text-amber-600 dark:text-amber-400 border-b-2 border-amber-500 bg-amber-50 dark:bg-amber-900/20">
            Search
          </button>
          <button id="ideasHistoryTab" class="flex-1 px-6 py-3 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 border-b-2 border-transparent">
            History
          </button>
        </div>
      </div>
      <div id="ideasSearchPanel" class="p-6">
        <div class="mb-6 flex gap-3">
          <input type="text" id="strategySearchInputGlobal" placeholder="Search for strategies (e.g., breakout, RSI, moving average)..." class="flex-1 px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
          <button id="searchStrategiesBtnGlobal" class="px-6 py-3 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 text-white font-medium rounded-xl transition-colors flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            Search
          </button>
        </div>
        <div class="mb-6 flex flex-wrap gap-2">
          <button class="strategy-chip px-3 py-1.5 rounded-full text-sm font-medium bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 hover:bg-indigo-200 dark:hover:bg-indigo-800 transition-colors" data-cat="breakout">Breakout</button>
          <button class="strategy-chip px-3 py-1.5 rounded-full text-sm font-medium bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-800 transition-colors" data-cat="trend following">Trend Following</button>
          <button class="strategy-chip px-3 py-1.5 rounded-full text-sm font-medium bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 hover:bg-purple-200 dark:hover:bg-purple-800 transition-colors" data-cat="mean reversion">Mean Reversion</button>
          <button class="strategy-chip px-3 py-1.5 rounded-full text-sm font-medium bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800 transition-colors" data-cat="scalping">Scalping</button>
          <button class="strategy-chip px-3 py-1.5 rounded-full text-sm font-medium bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors" data-cat="RSI">RSI</button>
          <button class="strategy-chip px-3 py-1.5 rounded-full text-sm font-medium bg-yellow-100 dark:bg-yellow-900/50 text-yellow-700 dark:text-yellow-300 hover:bg-yellow-200 dark:hover:bg-yellow-800 transition-colors" data-cat="MACD">MACD</button>
          <button class="strategy-chip px-3 py-1.5 rounded-full text-sm font-medium bg-pink-100 dark:bg-pink-900/50 text-pink-700 dark:text-pink-300 hover:bg-pink-200 dark:hover:bg-pink-800 transition-colors" data-cat="bollinger bands">Bollinger</button>
        </div>
        <div id="strategyResultsGlobal" class="max-h-[400px] overflow-y-auto space-y-4">
          <div class="text-center py-12 text-gray-500 dark:text-gray-400">
            <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            <p class="text-lg font-medium mb-2">Search for strategy ideas</p>
            <p class="text-sm">Click a category or enter a search term</p>
          </div>
        </div>
        <div id="strategyLoadingGlobal" class="hidden text-center py-12">
          <svg class="w-12 h-12 mx-auto mb-4 animate-spin text-amber-500" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
          </svg>
          <p class="text-gray-600 dark:text-gray-400">Searching ProRealCode...</p>
        </div>
      </div>
      <div id="ideasHistoryPanel" class="p-6 hidden">
        <div id="searchHistoryList" class="max-h-[500px] overflow-y-auto space-y-4">
          <div class="text-center py-12 text-gray-500 dark:text-gray-400">
            <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <p class="text-lg font-medium mb-2">No search history yet</p>
            <p class="text-sm">Your searches will appear here</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ProRealTime Documentation Modal -->
  <div id="prtDocsModal" class="fixed inset-0 bg-black/50 z-[100] hidden items-center justify-center p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
      <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
          <svg class="w-6 h-6 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
          </svg>
          ProRealTime Syntax Reference
        </h3>
        <button id="closePrtDocsModal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="flex h-[70vh]">
        <div class="w-64 border-r border-gray-200 dark:border-gray-700 overflow-y-auto p-4">
          <div class="mb-4">
            <button id="addNewDocBtn" class="w-full px-3 py-2 bg-teal-600 hover:bg-teal-700 text-white text-sm font-medium rounded-lg transition-colors flex items-center justify-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
              </svg>
              Add New Doc
            </button>
          </div>
          <div id="prtDocsList" class="space-y-2">
            <p class="text-sm text-gray-500 dark:text-gray-400 italic">Loading...</p>
          </div>
        </div>
        <div class="flex-1 flex flex-col">
          <div id="prtDocEditor" class="hidden flex-1 flex flex-col">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 space-y-3">
              <div class="flex items-center gap-3">
                <input type="text" id="prtDocTitle" placeholder="Document title" class="flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
                <label class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                  <input type="checkbox" id="prtDocAlwaysInclude" class="rounded">
                  Always include
                </label>
              </div>
              <input type="text" id="prtDocKeywords" placeholder="Keywords (comma-separated, e.g., trailing, stop, ptrailing)" class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 text-sm">
            </div>
            <textarea id="prtDocContent" class="flex-1 p-4 bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-mono text-sm resize-none" placeholder="Enter documentation content (Markdown supported)..."></textarea>
            <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between">
              <button id="deletePrtDoc" class="px-4 py-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 font-medium rounded-lg transition-colors">Delete</button>
              <button id="savePrtDoc" class="px-6 py-2 bg-teal-600 hover:bg-teal-700 text-white font-medium rounded-lg transition-colors">Save Changes</button>
            </div>
          </div>
          <div id="prtDocPlaceholder" class="flex-1 flex items-center justify-center text-gray-500 dark:text-gray-400">
            <div class="text-center">
              <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
              </svg>
              <p class="text-lg font-medium mb-2">Select a document to edit</p>
              <p class="text-sm">Or click "Add New Doc" to create one</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Donation Modal -->
  <div id="donationModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" id="donationModalOverlay"></div>
      <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-lg p-6 border border-gray-200 dark:border-gray-700">
        <button id="closeDonationModal" class="absolute top-4 right-4 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
          <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
        
        <div class="text-center mb-6">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-amber-400 to-orange-500 mb-4">
            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M2 21h18v-2H2M20 8h-2V5h2m0-2H4v10a4 4 0 0 0 4 4h6a4 4 0 0 0 4-4v-3h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/>
            </svg>
          </div>
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Buy Me a Coffee!</h2>
          <p class="text-gray-600 dark:text-gray-400 text-sm">(or Bread... Literally Just Bread)</p>
        </div>
        
        <div class="bg-amber-50 dark:bg-amber-900/20 rounded-xl p-4 mb-6 border border-amber-200 dark:border-amber-700">
          <p class="text-sm text-amber-800 dark:text-amber-200 text-center leading-relaxed">
            Hey there! I'm just a humble coder surviving on a strict diet of bread and water (the sparkling kind on good days). 
            Your donation could upgrade my dinner from "plain bread" to "bread with butter and coffee" or even the legendary "bread with cheese sandwich and coffee" combo!
          </p>
        </div>
        
        <div class="space-y-4">
          <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center">
                <span class="text-white text-xs font-bold">ETH</span>
              </div>
              <span class="font-semibold text-gray-900 dark:text-white">Ethereum</span>
              <span class="text-xs text-gray-500 dark:text-gray-400 italic ml-auto">Gas me up!</span>
            </div>
            <div class="flex items-center gap-2">
              <code class="flex-1 text-xs bg-white dark:bg-gray-800 px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-300 overflow-x-auto">0xf5D65740108977498E14776F1D5E2c6CefFa2666</code>
              <button onclick="navigator.clipboard.writeText('0xf5D65740108977498E14776F1D5E2c6CefFa2666');this.innerHTML='<svg class=\'w-4 h-4 text-green-500\' fill=\'none\' stroke=\'currentColor\' viewBox=\'0 0 24 24\'><path stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'2\' d=\'M5 13l4 4L19 7\'/></svg>';setTimeout(()=>this.innerHTML='<svg class=\'w-4 h-4\' fill=\'none\' stroke=\'currentColor\' viewBox=\'0 0 24 24\'><path stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'2\' d=\'M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\'/></svg>',1500)" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" title="Copy">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </button>
            </div>
          </div>
          
          <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
            <div class="flex items-center gap-3 mb-3">
              <div class="w-8 h-8 rounded-full bg-orange-500 flex items-center justify-center">
                <span class="text-white text-xs font-bold">BTC</span>
              </div>
              <span class="font-semibold text-gray-900 dark:text-white">Bitcoin</span>
              <span class="text-xs text-gray-500 dark:text-gray-400 italic ml-auto">OG hodler style</span>
            </div>
            <div class="flex items-center gap-2">
              <code class="flex-1 text-xs bg-white dark:bg-gray-800 px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-300 overflow-x-auto">bc1qsny8dhsnmv0hzs7ctsmfxy2cn7vqk79gs0acv0</code>
              <button onclick="navigator.clipboard.writeText('bc1qsny8dhsnmv0hzs7ctsmfxy2cn7vqk79gs0acv0');this.innerHTML='<svg class=\'w-4 h-4 text-green-500\' fill=\'none\' stroke=\'currentColor\' viewBox=\'0 0 24 24\'><path stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'2\' d=\'M5 13l4 4L19 7\'/></svg>';setTimeout(()=>this.innerHTML='<svg class=\'w-4 h-4\' fill=\'none\' stroke=\'currentColor\' viewBox=\'0 0 24 24\'><path stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'2\' d=\'M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\'/></svg>',1500)" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" title="Copy">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
        
        <p class="text-center text-xs text-gray-500 dark:text-gray-400 mt-6 italic">
          Side effects may include: warm fuzzy feelings, instant karma, and knowing you helped a coder level up from instant noodles to... slightly better instant noodles.
        </p>
      </div>
    </div>
  </div>

  <!-- Video Player Popup -->
  <div id="videoPlayerPopup" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80">
    <div class="relative max-w-2xl w-full mx-4 bg-gray-900 rounded-xl overflow-hidden shadow-2xl">
      <button id="closeVideoPlayer" class="absolute top-3 right-3 z-10 p-2 bg-black/50 hover:bg-black/70 text-white rounded-full transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
      <div class="aspect-video relative bg-gradient-to-br from-purple-900 to-gray-900 flex items-center justify-center">
        <video id="videoPlayerMainVideo" class="absolute inset-0 w-full h-full object-contain hidden" controls></video>
        <div id="videoPlayerAudioMode" class="flex items-center justify-center w-full h-full">
          <img id="videoPlayerAvatar" src="/images/presenter-caelix.png" alt="Presenter" class="w-48 h-48 rounded-full object-cover border-4 border-purple-500 shadow-xl shadow-purple-500/30 animate-pulse">
        </div>
      </div>
      <div class="p-4 bg-gray-800">
        <div class="flex items-center gap-3 mb-3">
          <img id="videoPlayerPresenterSmall" src="/images/presenter-caelix.png" alt="Presenter" class="w-10 h-10 rounded-full object-cover border-2 border-purple-500">
          <div class="flex-1">
            <p id="videoPlayerPresenterName" class="text-white font-medium">Magos Caelix-9</p>
            <p id="videoPlayerStationName" class="text-gray-400 text-xs">Forge World Markets</p>
          </div>
          <span id="videoPlayerTime" class="text-gray-400 text-sm">0:00 / 0:00</span>
        </div>
        <div class="flex items-center gap-3">
          <button id="videoPlayerPlayBtn" class="p-3 bg-purple-600 hover:bg-purple-700 text-white rounded-full transition-colors">
            <svg class="w-6 h-6" id="videoPlayerPlayIcon" fill="currentColor" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z"/>
            </svg>
          </button>
          <div class="flex-1 h-2 bg-gray-700 rounded-full cursor-pointer" id="videoPlayerProgressTrack">
            <div id="videoPlayerProgress" class="h-full bg-purple-500 rounded-full" style="width: 0%"></div>
          </div>
          <a id="videoPlayerDownloadMp3" href="#" download class="p-2 text-gray-400 hover:text-green-500 transition-colors" title="Download MP3">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
          </a>
          <a id="videoPlayerDownloadMp4" href="#" download class="p-2 text-gray-400 hover:text-purple-500 transition-colors hidden" title="Download MP4">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/>
            </svg>
          </a>
          <button id="videoPlayerShareBtn" class="p-2 text-gray-400 hover:text-blue-500 transition-colors" title="Share">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>
